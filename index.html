<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trauma Team International - Your Elite Medical Response</title>

  <style>
    /* --- Loading Screen Styles --- */
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease-out;
    }

    .loading-logo {
      height: 80px;
      margin-bottom: 30px;
      mix-blend-mode: screen;
      filter: drop-shadow(0 0 10px var(--accent-red));
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--secondary-dark);
      border-top: 4px solid var(--accent-red);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin { 
      0% { transform: rotate(0deg); } 
      100% { transform: rotate(360deg); } 
    }

    .loading-text {
      color: var(--text-primary);
      font-size: 1.2rem;
      text-align: center;
    }

    /* --- Color Variables --- */
    :root {
      --bg-color: #000;
      --primary-dark: #1a1a1a;
      --secondary-dark: #2a2a2a;
      --text-primary: #f5f5f5;
      --text-secondary: #a0a0a0;
      --accent-red: #e50914;
      --accent-red-hover: #f40612;
      --accent-blue: #007bff;
      --accent-blue-hover: #0056b3;
      --accent-green: #28a745;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-image: url("main-bg.webp");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-color: var(--bg-color);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.6;
      position: relative;
    }

    body::before {
      content: "";
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.85);
      z-index:-1;
    }

    .navbar {
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      padding: 10px 20px;
      border-bottom: 1px solid var(--secondary-dark);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: center;
    }

    .navbar-brand {
      font-size: 1.5rem;
      color: white;
      text-decoration: none;
      font-weight: bold;
      display:flex;
      align-items:center;
    }

    .navbar-brand img {
      height: 40px;
      margin-right: 15px;
      mix-blend-mode: screen;
    }

    /* HERO */
    .hero {
      text-align: center;
      padding: 200px 20px 150px;
    }

    .hero-content {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }

    .hero h1 {
      font-size: 3.5rem;
      font-weight: 900;
      color: var(--text-primary);
      text-shadow: 0 2px 8px rgba(0,0,0,0.7);
    }

    .hero h1 span { color: var(--accent-red); }

    .hero p {
      font-size: 1.3rem;
      color: var(--text-secondary);
    }

    /* BUTTONS */
    .btn {
      background: var(--accent-red);
      color: white;
      padding: 14px 28px;
      border-radius: 5px;
      font-weight: bold;
      cursor:pointer;
      border:none;
      transition: 0.3s;
      box-shadow: 0 4px 15px rgba(229,9,20,0.3);
      text-transform:uppercase;
      display:inline-block;
      margin: 5px 0;
    }

    .btn:hover {
      background: var(--accent-red-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(229,9,20,0.6);
    }

    /* CONTENT CONTAINERS */
    .container {
      background: var(--primary-dark);
      padding:40px;
      border-radius:10px;
      margin: 40px auto;
      max-width:600px;
      border:1px solid var(--secondary-dark);
      box-shadow:0 10px 30px rgba(0,0,0,0.5);
    }

    h2 {
      text-align:center;
      font-size:2.5rem;
      margin-bottom:30px;
      color:var(--text-primary);
    }

    /* FEATURES */
    .feature-cards {
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:20px;
    }

    .card {
      background: var(--primary-dark);
      border:1px solid var(--secondary-dark);
      border-radius:8px;
      width:300px;
      padding:30px;
      transition:0.3s;
      box-shadow:0 4px 15px rgba(0,0,0,0.3);
    }

    .card:hover {
      transform:scale(1.05);
      border-color: var(--accent-red);
      box-shadow:0 8px 30px rgba(229,9,20,0.4);
    }

    .card h3 { color:var(--accent-red); margin-bottom:10px; }

    /* DOCTOR LIST */
    .doctor-list {
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:30px;
      max-width:1200px;
      margin:auto;
    }

    .doctor-card {
      background: var(--primary-dark);
      border:1px solid var(--secondary-dark);
      width:280px;
      border-radius:10px;
      text-align:center;
      padding:30px 20px;
      transition:0.3s;
      cursor:pointer;
    }

    .doctor-card:hover {
      transform:translateY(-5px);
      box-shadow:0 10px 25px rgba(229,9,20,0.3);
    }

    .doctor-card.selected {
      border-color: var(--accent-red);
      box-shadow:0 0 25px rgba(229,9,20,0.6);
      transform:scale(1.05);
    }

    .doctor-image-container {
      width:150px;
      height:150px;
      margin-bottom:20px;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .doctor-card img {
      width:100%;
      height:100%;
      border-radius:50%;
      object-fit:cover;
      border:4px solid var(--accent-red);
    }

    .doctor-img-fallback {
      width:150px;
      height:150px;
      border-radius:50%;
      font-size:3.5rem;
      background:var(--secondary-dark);
      border:4px solid var(--accent-red);
      display:flex;
      justify-content:center;
      align-items:center;
    }

    /* FORM */
    .form-group { margin-bottom:20px; text-align:left; }

    label { margin-bottom:6px; display:block; color:var(--text-secondary); }

    input, select, textarea {
      width:100%;
      padding:12px;
      background:var(--secondary-dark);
      border:1px solid var(--secondary-dark);
      color:var(--text-primary);
      border-radius:5px;
      font-size:16px;
    }

    input:focus, select:focus, textarea:focus {
      outline:none;
      border-color: var(--accent-red);
      box-shadow:0 0 0 3px rgba(229,9,20,0.3);
    }

    .error-message {
      font-size:14px;
      color:#ff6b6b;
      margin-top:4px;
    }

    /* CHAT WIDGET */
    .chat-widget {
      position:fixed;
      bottom:20px;
      right:20px;
      z-index:1000;
    }

    .chat-button {
      background:var(--accent-red);
      color:white;
      border:none;
      width:60px; height:60px;
      font-size:24px;
      border-radius:50%;
      cursor:pointer;
      box-shadow:0 4px 15px rgba(229,9,20,0.4);
      transition:0.3s;
    }

    .chat-button:hover {
      background:var(--accent-red-hover);
      transform:scale(1.1);
    }
  </style>
</head>

<body>

<!-- Loading Screen -->
<div id="loadingScreen">
  <img src="logo.webp" class="loading-logo" alt="Trauma Team Logo" onerror="this.style.display='none';">
  <div class="spinner"></div>
  <div class="loading-text">Initializing mini-project...</div>
</div>

<header>
  <nav class="navbar">
    <a class="navbar-brand" href="#">
      <img src="logo.webp" alt="Trauma Team Logo" onerror="this.style.display='none'">
      Trauma Team
    </a>
  </nav>
</header>

<main>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-content js-scroll">
      <h1>Welcome to <span>Trauma Team International</span></h1>
      <p>Your Elite Medical Response. Anytime. Anywhere.</p>
      <a href="#book" class="btn">Book a Consultation</a>
    </div>
  </section>

  <!-- FEATURES -->
  <section class="features container js-scroll">
    <h2>Response Packages</h2>
    <div class="feature-cards">
      <div class="card">
        <h3>Rapid Response</h3>
        <p>Immediate dispatch & emergency consultation.</p>
      </div>
      <div class="card">
        <h3>Corporate Coverage</h3>
        <p>Full medical support for organizations.</p>
      </div>
      <div class="card">
        <h3>Executive Protection</h3>
        <p>VIP trauma medical response anywhere.</p>
      </div>
    </div>
  </section>

  <!-- DOCTOR LIST -->
  <section class="doctors js-scroll">
    <h2>Meet Our Elite Responders</h2>

    <div class="doctor-list" id="doctorList">
      <div class="doctor-card" data-doc="Dr. R. Sharma">
        <div class="doctor-image-container">
          <img src="doctor1.jpg" alt="Dr. Sharma"
               onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë®‚Äç‚öïÔ∏è</div>';">
        </div>
        <h4>Dr. R. Sharma</h4>
        <p>Chief Medical Officer</p>
      </div>

      <div class="doctor-card" data-doc="Dr. M. Gupta">
        <div class="doctor-image-container">
          <img src="doctor2.png" alt="Dr. Gupta"
               onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë©‚Äç‚öïÔ∏è</div>';">
        </div>
        <h4>Dr. M. Gupta</h4>
        <p>Orthopedic & Plastic Surgeon</p>
      </div>

      <div class="doctor-card" data-doc="Dr. Jyoti">
        <div class="doctor-image-container">
          <img src="doctor3.png" alt="Dr. Jyoti"
               onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë®‚Äç‚öïÔ∏è</div>';">
        </div>
        <h4>Dr. Jyoti</h4>
        <p>Trauma & Surgical Lead</p>
      </div>
    </div>
  </section>

  <!-- BOOKING FORM -->
  <section id="book" class="container cta js-scroll">
    <h2>Schedule Consultation</h2>
    <p>Your connection to our elite medical team is one click away.</p>

    <button id="showFormBtn" class="btn" type="button">Book Now</button>

    <form id="bookingForm" style="display:none; margin-top:20px;">
      
      <div class="form-group">
        <label>Full Name:</label>
        <input type="text" id="patientName" required>
        <span id="nameError" class="error-message"></span>
      </div>

      <div class="form-group">
        <label>Email:</label>
        <input type="email" id="email" required>
        <span id="emailError" class="error-message"></span>
      </div>

      <div class="form-group">
        <label>Select Specialist:</label>
        <select id="doctor" required>
          <option value="">-- Choose Specialist --</option>
          <option value="Dr. R. Sharma">Dr. R. Sharma</option>
          <option value="Dr. M. Gupta">Dr. M. Gupta</option>
          <option value="Dr. Jyoti">Dr. Jyoti</option>
        </select>
        <span id="doctorError" class="error-message"></span>
      </div>

      <div class="form-group">
        <label>Consultation Date:</label>
        <input type="date" id="appointmentDate" required>
        <span id="dateError" class="error-message"></span>
      </div>

      <div class="form-group">
        <label>Consultation Time:</label>
        <input type="time" id="appointmentTime" required>
        <span id="timeError" class="error-message"></span>
      </div>

      <div class="form-group">
        <label>Additional Notes:</label>
        <textarea id="message" rows="3"></textarea>
      </div>

      <button class="btn" id="submitBooking" type="submit">Confirm Consultation</button>

      <div id="formMessage" class="message" style="display:none;"></div>
    </form>
  </section>

  <!-- INVOICE SCREEN -->
  <section id="invoiceScreen" style="
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.95); display:none; z-index:2000;
      justify-content:center; align-items:center; padding:20px;">

    <div class="invoice-box">
      <div class="invoice-header">
        <h2>üéâ Consultation Received!</h2>
        <p>Your booking has been received by Trauma Team International</p>
      </div>

      <div class="invoice-details">
        <div class="invoice-section">
          <h3>Patient Information</h3>
          <p><strong>Name:</strong> <span id="invoicePatientName"></span></p>
          <p><strong>Email:</strong> <span id="invoicePatientEmail"></span></p>
        </div>

        <div class="invoice-section">
          <h3>Appointment Details</h3>
          <p><strong>Doctor:</strong> <span id="invoiceDoctor"></span></p>
          <p><strong>Date:</strong> <span id="invoiceDate"></span></p>
          <p><strong>Time:</strong> <span id="invoiceTime"></span></p>
        </div>

        <div class="invoice-section">
          <h3>Booking Info</h3>
          <p><strong>Invoice ID:</strong> <span id="invoiceId"></span></p>
          <p><strong>Amount:</strong> <span id="invoiceAmount"></span></p>
          <p><strong>Status:</strong> <span id="invoicePaymentStatus">PENDING</span></p>
        </div>
      </div>

      <div class="invoice-actions">
        <button class="btn btn-success" onclick="window.print()">üñ®Ô∏è Print</button>
        <button id="doneButton" class="btn btn-secondary">Done</button>
      </div>
    </div>
  </section>

  <!-- CHAT WIDGET -->
  <div class="chat-widget">
    <button class="chat-button" id="chatToggle">üí¨</button>

    <div class="chat-container" id="chatContainer" style="display:none;">
      <div class="chat-header">
        <span>üöë Emergency Dispatch</span>
        <button class="close-chat" id="closeChat">√ó</button>
      </div>

      <div class="chat-messages" id="chatMessages">
        <div class="message bot-message">
          ‚ù§Ô∏è Welcome to Trauma Team Dispatch. Choose an option below.
        </div>
      </div>

      <div class="quick-options" id="quickOptions">
        <button class="quick-option" data-option="emergency">üö® Emergency</button>
        <button class="quick-option" data-option="dispatch">üìç Dispatch Request</button>
        <button class="quick-option" data-option="symptoms">ü§í Symptoms</button>
        <button class="quick-option" data-option="contact">üìû Call Back</button>
      </div>

      <div class="typing-indicator" id="typingIndicator">Dispatch is typing...</div>
    </div>
  </div>

</main>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-content">
    <p>üìç Trauma HQ, Dehradun, Uttarakhand, India</p>
    <p>üìû +91 98765 43210 | ‚úâÔ∏è dispatch@traumateam.com</p>

    <div class="social-icons">
      <a href="#"><img src="facebook.png" alt="Facebook"></a>
      <a href="#"><img src="instagram.png" alt="Instagram"></a>
      <a href="#"><img src="twitter.png" alt="Twitter"></a>
    </div>

    <p style="margin-top:15px;">¬© 2025 Trauma Team International</p>
  </div>
</footer>
<script>
/******************************************************************
 * Trauma Team Frontend ‚Äî Clean Final Build
 * Backend: https://traumateam-backend-1.onrender.com
 ******************************************************************/

const API_BASE_URL = "https://traumateam-backend-1.onrender.com";

const DOCTOR_PRICES = {
  "Dr. R. Sharma": 15000,
  "Dr. M. Gupta": 12000,
  "Dr. Jyoti": 18000
};

let currentBooking = null;

/* ----------------------- API CLIENT ------------------------- */
class TraumaTeamAPI {
  constructor(baseURL) {
    this.baseURL = baseURL.replace(/\/+$/, "");
  }

  async request(path, opts = {}) {
    const url = this.baseURL + path;

    const options = {
      method: opts.method || "GET",
      mode: "cors",
      headers: {
        "Content-Type": "application/json",
        ...(opts.headers || {})
      },
      body: opts.body || null
    };

    const res = await fetch(url, options);

    if (!res.ok) {
      const text = await res.text().catch(() => "");
      const message = text || `Request failed: ${res.status} ${res.statusText}`;
      throw new Error(message);
    }

    const ct = res.headers.get("content-type") || "";
    if (ct.includes("application/json")) return res.json();

    return {};
  }

  createBooking(data) {
    return this.request("/bookings/", {
      method: "POST",
      body: JSON.stringify(data)
    });
  }
}

const api = new TraumaTeamAPI(API_BASE_URL);

/* ----------------- Utility: Safe HTML escaping ---------------- */
function escapeHtml(text) {
  if (!text) return "";
  return String(text)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

/* ----------------------- Validation --------------------------- */
function validateForm() {
  let valid = true;

  const fields = ["patientName", "email", "doctor", "appointmentDate", "appointmentTime"];
  fields.forEach((f) => (document.getElementById(f + "Error").textContent = ""));

  const name = document.getElementById("patientName").value.trim();
  const email = document.getElementById("email").value.trim();
  const doctor = document.getElementById("doctor").value;
  const dateVal = document.getElementById("appointmentDate").value;
  const timeVal = document.getElementById("appointmentTime").value;

  if (!name) {
    document.getElementById("nameError").textContent = "This field is required";
    valid = false;
  }

  if (!email) {
    document.getElementById("emailError").textContent = "This field is required";
    valid = false;
  } else {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!re.test(email)) {
      document.getElementById("emailError").textContent = "Enter a valid email";
      valid = false;
    }
  }

  if (!doctor) {
    document.getElementById("doctorError").textContent = "Please select a specialist";
    valid = false;
  }

  if (!dateVal) {
    document.getElementById("dateError").textContent = "Please choose a date";
    valid = false;
  } else if (new Date(dateVal) < new Date().setHours(0, 0, 0, 0)) {
    document.getElementById("dateError").textContent = "Date cannot be in the past";
    valid = false;
  }

  if (!timeVal) {
    document.getElementById("timeError").textContent = "Please choose a time";
    valid = false;
  }

  return valid;
}

/* --------------------- Invoice Screen Logic ------------------- */
function populateInvoice(data) {
  document.getElementById("invoicePatientName").textContent = escapeHtml(data.patient_name);
  document.getElementById("invoicePatientEmail").textContent = escapeHtml(data.email);
  document.getElementById("invoiceDoctor").textContent = escapeHtml(data.doctor);
  document.getElementById("invoiceDate").textContent = escapeHtml(data.appointment_date);
  document.getElementById("invoiceTime").textContent = escapeHtml(data.appointment_time);
  document.getElementById("invoiceId").textContent = escapeHtml(data.invoice_id);

  const price = DOCTOR_PRICES[data.doctor] || 0;
  document.getElementById("invoiceAmount").textContent = `‚Çπ${price.toLocaleString()}`;
}

function showInvoiceScreen(data) {
  currentBooking = data;
  populateInvoice(data);

  document.getElementById("invoiceScreen").style.display = "flex";
  document.querySelector("main").style.display = "none";
  document.querySelector("header").style.display = "none";
  document.querySelector("footer").style.display = "none";

  window.scrollTo(0, 0);
}

function closeInvoiceScreen() {
  document.getElementById("invoiceScreen").style.display = "none";

  document.querySelector("main").style.display = "block";
  document.querySelector("header").style.display = "block";
  document.querySelector("footer").style.display = "block";

  const form = document.getElementById("bookingForm");
  form.reset();
  form.style.display = "none";

  document.getElementById("showFormBtn").style.display = "inline-block";
}

/* ----------------------- Booking Submit ------------------------ */
document.addEventListener("DOMContentLoaded", () => {
  // hide loading screen
  window.addEventListener("load", () => {
    setTimeout(() => {
      const ls = document.getElementById("loadingScreen");
      ls.style.opacity = "0";
      setTimeout(() => (ls.style.display = "none"), 500);
    }, 600);
  });

  const showFormBtn = document.getElementById("showFormBtn");
  const bookingForm = document.getElementById("bookingForm");

  showFormBtn.addEventListener("click", () => {
    bookingForm.style.display = "block";
    showFormBtn.style.display = "none";
    bookingForm.scrollIntoView({ behavior: "smooth" });
  });

  // set minimum date to today
  document.getElementById("appointmentDate").min = new Date().toISOString().split("T")[0];

  bookingForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!validateForm()) return;

    const submitBtn = document.getElementById("submitBooking");
    const originalText = submitBtn.textContent;

    submitBtn.disabled = true;
    submitBtn.textContent = "Processing...";

    try {
      const payload = {
        patient_name: document.getElementById("patientName").value.trim(),
        email: document.getElementById("email").value.trim(),
        doctor: document.getElementById("doctor").value,
        appointment_date: document.getElementById("appointmentDate").value,
        appointment_time: document.getElementById("appointmentTime").value,
        message: document.getElementById("message").value.trim() || "No additional notes"
      };

      if (!DOCTOR_PRICES[payload.doctor]) throw new Error("Invalid doctor selection");

      const result = await api.createBooking(payload);

      showInvoiceScreen(result);

    } catch (err) {
      alert("Booking error: " + err.message);
    }

    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  });

  /* ------------------------ CHAT SYSTEM ---------------------- */

  const chatToggle = document.getElementById("chatToggle");
  const chatContainer = document.getElementById("chatContainer");
  const closeChat = document.getElementById("closeChat");
  const chatMessages = document.getElementById("chatMessages");
  const quickOptions = document.getElementById("quickOptions");
  const typingIndicator = document.getElementById("typingIndicator");

  const botReplies = {
    emergency:
      "üö® EMERGENCY PROTOCOL ACTIVATED! Trauma Team is being dispatched immediately.",
    dispatch:
      "üìç Dispatch request logged. Please confirm your current location.",
    symptoms:
      "ü§í Please describe your symptoms. Our medical AI will analyze instantly.",
    contact:
      "üìû A callback has been scheduled. You will receive a phone call shortly."
  };

  function appendMessage(text, user) {
    const div = document.createElement("div");
    div.className = `message ${user ? "user-message" : "bot-message"}`;
    div.textContent = text;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function handleQuickOption(option) {
    appendMessage(option, true);
    typingIndicator.style.display = "block";

    setTimeout(() => {
      typingIndicator.style.display = "none";
      appendMessage(botReplies[option], false);
    }, 900);
  }

  chatToggle.addEventListener("click", () => {
    chatContainer.style.display = "flex";
  });

  closeChat.addEventListener("click", () => {
    chatContainer.style.display = "none";
  });

  document.querySelectorAll(".quick-option").forEach((btn) => {
    btn.addEventListener("click", () => {
      handleQuickOption(btn.dataset.option);
    });
  });

  document.getElementById("doneButton").addEventListener("click", closeInvoiceScreen);
});

/* -------------------- Helper: Show Booking Section ------------ */
function showBookingSection() {
  document.querySelectorAll("main > section").forEach((s) => (s.style.display = "none"));
  document.getElementById("book").style.display = "block";
  document.getElementById("showFormBtn").style.display = "inline-block";
  document.getElementById("bookingForm").style.display = "none";
}
</script>
