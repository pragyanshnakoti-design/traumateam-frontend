<!-- PART 1: head + css + body header/hero/features/doctors (paste first) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trauma Team International - Your Elite Medical Response</title>
  <style>
    /* --- Loading Screen Styles --- */
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease-out;
    }

    .loading-logo {
      height: 80px;
      margin-bottom: 30px;
      mix-blend-mode: screen;
      filter: drop-shadow(0 0 10px var(--accent-red));
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--secondary-dark);
      border-top: 4px solid var(--accent-red);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--text-primary);
      font-size: 1.2rem;
      text-align: center;
    }

    /* --- CSS Variables --- */
    :root {
      --bg-color: #000000;
      --primary-dark: #1a1a1a;
      --secondary-dark: #2a2a2a;
      --text-primary: #f5f5f5;
      --text-secondary: #a0a0a0;
      --accent-red: #e50914;
      --accent-red-hover: #f40612;
      --accent-blue: #007bff;
      --accent-blue-hover: #0056b3;
      --accent-green: #28a745;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-image: url('main-bg.webp');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-color: var(--bg-color);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.6;
      position: relative;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
        z-index: -1;
    }

    .navbar {
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        padding: 10px 20px;
        border-bottom: 1px solid var(--secondary-dark);
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        justify-content: center;
    }
    .navbar-brand {
        color: white;
        text-decoration: none;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        font-weight: bold;
    }
    .navbar-brand img {
        height: 40px;
        margin-right: 15px;
        mix-blend-mode: screen;
    }

    .hero {
      background: transparent;
      text-align: center;
      padding: 200px 20px 150px 20px;
      position: relative;
      flex-shrink: 0;
    }

    .hero-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
      margin: 0 auto;
      background: transparent;
      padding: 20px;
      border-radius: 10px;
    }

    .hero h1 {
      font-size: 3.5rem;
      font-weight: 900;
      margin-bottom: 15px;
      color: var(--text-primary);
      text-shadow: 0 2px 8px rgba(0,0,0,0.7);
    }

    .hero h1 span {
      color: var(--accent-red);
    }

    .hero p {
      font-size: 1.3rem;
      color: var(--text-secondary);
      text-shadow: 0 1px 4px rgba(0,0,0,0.7);
      margin-bottom: 30px;
    }

    .btn {
      background-color: var(--accent-red);
      color: var(--text-primary);
      padding: 14px 28px;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      display: inline-block;
      text-transform: uppercase;
      box-shadow: 0 4px 15px rgba(229, 9, 20, 0.3);
    }

    .btn:hover {
      background-color: var(--accent-red-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(229, 9, 20, 0.6);
    }

    .btn:disabled {
      background-color: var(--secondary-dark);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background-color: var(--secondary-dark);
    }

    .btn-secondary:hover {
      background-color: #3a3a3a;
    }

    .btn-success {
      background-color: var(--accent-green);
    }

    .btn-success:hover {
      background-color: #218838;
    }

    .container {
      background-color: var(--primary-dark);
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 600px;
      margin: 40px auto;
      border: 1px solid var(--secondary-dark);
    }

    h2 {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 40px;
    }

    .features {
      max-width: 1200px;
      text-align: center;
    }

    .feature-cards {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .card {
      background: var(--primary-dark);
      border: 1px solid var(--secondary-dark);
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      padding: 30px;
      margin: 10px;
      width: 300px;
      transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
        transform: scale(1.05);
        border-color: var(--accent-red);
        box-shadow: 0 8px 30px rgba(229, 9, 20, 0.4);
    }

    .card h3 {
        color: var(--accent-red);
        font-size: 1.5rem;
        margin-top: 0;
    }

    .card p {
        color: var(--text-secondary);
        font-size: 1rem;
    }

    .doctors {
      background-color: transparent;
      padding: 60px 20px;
      text-align: center;
    }

    .doctor-list {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .doctor-card {
      background-color: var(--primary-dark);
      color: var(--text-primary);
      padding: 30px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      width: 280px;
      border: 1px solid var(--secondary-dark);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .doctor-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(229, 9, 20, 0.3);
    }

    .doctor-image-container {
      width: 150px;
      height: 150px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .doctor-card img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--accent-red);
    }

    .doctor-img-fallback {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 4px solid var(--accent-red);
      background: var(--secondary-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
    }

    .doctor-card h4 {
        font-size: 1.4rem;
        margin-bottom: 10px;
        color: var(--text-primary);
    }

    .doctor-card p {
        color: var(--text-secondary);
        font-size: 1rem;
        margin: 0;
        line-height: 1.5;
    }

    /* --- PATCH 3: Animated Doctor Selection UI --- */
    .doctor-card {
      position: relative;
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.35s ease, box-shadow 0.35s ease;
    }

    .doctor-card.selected {
      border-color: var(--accent-red);
      box-shadow: 0 0 25px rgba(229, 9, 20, 0.6);
      transform: scale(1.06);
    }

    .doctor-card::after {
      content: "SELECTED";
      position: absolute;
      bottom: -40px;
      left: 0;
      width: 100%;
      text-align: center;
      background: var(--accent-red);
      color: white;
      font-size: 0.85rem;
      font-weight: bold;
      padding: 8px 0;
      transition: bottom 0.3s ease;
    }

    .doctor-card.selected::after {
      bottom: 0;
    }

    .doctor-card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 12px 30px rgba(229, 9, 20, 0.35);
    }

    .cta { text-align: center; }
    .cta h2 { color: var(--text-primary); }
    .cta p { color: var(--text-secondary); font-size: 1.1rem; }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-weight: bold;
    }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    input[type="time"],
    select,
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--secondary-dark);
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
      background-color: var(--secondary-dark);
      color: var(--text-primary);
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator {
        filter: invert(1);
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent-red);
      box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.25);
      outline: none;
    }

    button[type="submit"] {
      width: 100%;
      margin-top: 10px;
    }

    .error-message {
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 5px;
      display: block;
      text-align: left;
    }

    .message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
      font-weight: bold;
    }

    .message.success {
      background-color: #198754;
      color: #fff;
    }

    .message.error {
      background-color: #dc3545;
      color: #fff;
    }

    .footer {
      background: var(--primary-dark);
      color: var(--text-secondary);
      padding: 40px 20px;
      text-align: center;
      margin-top: auto;
      border-top: 1px solid var(--secondary-dark);
    }

    .footer-content {
      position: relative;
      z-index: 1;
      max-width: 1000px;
      margin: 0 auto;
    }

    .social-icons { margin-top: 15px; }
    .social-icons a {
      display: inline-block;
      margin: 0 10px;
    }
    .social-icons img {
      width: 28px;
      transition: transform 0.2s ease, opacity 0.2s ease, filter 0.2s ease;
      opacity: 0.7;
      filter: grayscale(100%) invert(70%);
    }
    .social-icons img:hover {
      transform: scale(1.2);
      opacity: 1;
      filter: grayscale(0) invert(0) drop-shadow(0 0 5px var(--accent-red));
    }

    .app-links { margin: 20px 0; }
    .app-links a img {
      height: 40px;
      margin: 0 10px;
      opacity: 0.8;
      transition: opacity 0.2s ease, filter 0.2s ease;
    }
    .app-links a img:hover {
      opacity: 1;
      filter: drop-shadow(0 0 5px var(--accent-red));
    }

    .chat-btn {
      display: inline-block;
      background-color: var(--accent-blue);
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 25px;
      text-decoration: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
    }
    .chat-btn:hover {
      background-color: var(--accent-blue-hover);
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
    }

    .js-scroll {
      opacity: 0;
      transform: translateY(50px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }

    .js-scroll.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* --- Success Animation --- */
    .success-animation {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
    }

    .checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: block;
      stroke-width: 2;
      stroke: #4bb71b;
      stroke-miterlimit: 10;
      box-shadow: inset 0px 0px 0px #4bb71b;
      animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
    }

    .checkmark__circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 2;
      stroke-miterlimit: 10;
      stroke: #4bb71b;
      fill: none;
      animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
    }

    .checkmark__check {
      transform-origin: 50% 50%;
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
    }

    @keyframes stroke {
      100% {
        stroke-dashoffset: 0;
      }
    }

    @keyframes scale {
      0%, 100% {
        transform: none;
      }
      50% {
        transform: scale3d(1.1, 1.1, 1);
      }
    }

    @keyframes fill {
      100% {
        box-shadow: inset 0px 0px 0px 30px #4bb71b;
      }
    }

    /* --- Emergency Dispatch Chat Styles --- */
    .chat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
    }
    .chat-button {
      background-color: var(--accent-red);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(229, 9, 20, 0.4);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .chat-button:hover {
      background-color: var(--accent-red-hover);
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(229, 9, 20, 0.6);
    }
    .chat-container {
      position: absolute;
      bottom: 70px;
      right: 0;
      width: 350px;
      height: 500px;
      background: var(--primary-dark);
      border: 1px solid var(--secondary-dark);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      display: none;
      flex-direction: column;
      overflow: hidden;
    }
    .chat-header {
      background: var(--accent-red);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .close-chat {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
    .chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      padding: 10px 15px;
      border-radius: 18px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .user-message {
      background: var(--accent-blue);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 5px;
    }
    .bot-message {
      background: var(--secondary-dark);
      color: var(--text-primary);
      align-self: flex-start;
      border-bottom-left-radius: 5px;
    }
    .quick-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid var(--secondary-dark);
    }
    .quick-option {
      background: var(--secondary-dark);
      color: var(--text-primary);
      border: 1px solid var(--accent-red);
      border-radius: 20px;
      padding: 8px 15px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .quick-option:hover {
      background: var(--accent-red);
      color: white;
      box-shadow: 0 4px 10px rgba(229, 9, 20, 0.4);
    }
    .typing-indicator {
      display: none;
      align-self: flex-start;
      background: var(--secondary-dark);
      color: var(--text-secondary);
      padding: 10px 15px;
      border-radius: 18px;
      font-style: italic;
    }

    /* Invoice Screen Styles */
    #invoiceScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.95);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .invoice-box {
      background-color: var(--primary-dark);
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 700px;
      border: 1px solid var(--secondary-dark);
    }

    .invoice-header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--accent-red);
      padding-bottom: 20px;
    }

    .invoice-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .invoice-section {
      background: var(--secondary-dark);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--text-secondary);
    }

    .invoice-section h3 {
      color: var(--accent-red);
      margin-top: 0;
      border-bottom: 1px solid var(--accent-red);
      padding-bottom: 10px;
    }

    .invoice-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 30px;
    }

    /* Appointment History */
    .appointment-history {
      margin-top: 40px;
    }

    .appointment-card {
      background: var(--secondary-dark);
      border: 1px solid var(--accent-red);
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      transition: all 0.3s ease;
    }

    .appointment-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3);
    }

    .appointment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .appointment-status {
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
    }

    .status-confirmed {
      background: #28a745;
      color: white;
    }

    .status-pending {
      background: #ffc107;
      color: black;
    }

    .status-completed {
      background: #17a2b8;
      color: white;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .hero {
        padding: 150px 20px 100px;
      }

      .hero h1 {
        font-size: 2.5rem;
      }

      .container {
        padding: 20px;
        width: 95%;
      }

      .chat-container {
        width: 300px;
        height: 400px;
      }

      .doctor-list {
        gap: 20px;
      }

      .doctor-card {
        width: 100%;
        max-width: 280px;
      }

      .appointment-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .invoice-details {
        grid-template-columns: 1fr;
      }

      .invoice-actions {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .chat-container {
        width: 280px;
        right: -20px;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen">
    <img src="logo.webp" alt="Trauma Team Logo" class="loading-logo" onerror="this.style.display='none';">
    <div class="spinner"></div>
    <div class="loading-text">.Initializing mini-project.</div>
  </div>

  <header>
    <nav class="navbar">
      <a class="navbar-brand" href="#">
        <img src="logo.webp" alt="Trauma Team Logo" onerror="this.style.display='none'; this.nextSibling?.remove();">
        <span></span>
      </a>
    </nav>
  </header>

  <main>
    <section class="hero">
      <div class="hero-content js-scroll">
        <h1>Welcome to <span>Trauma Team International</span></h1>
        <p>Your Elite Medical Response. Anytime. Anywhere.</p>
        <br>
        <a href="#book" class="btn">Book a Consultation</a>
      </div>
    </section>

    <section class="features container js-scroll">
      <h2>Response Packages</h2>
      <div class="feature-cards">
        <div class="card">
          <h3>Rapid Response</h3>
          <p>Immediate dispatch and consultation for critical and urgent health needs.</p>
        </div>
        <div class="card">
          <h3>Corporate Coverage</h3>
          <p>Full-service medical plans and on-site care for your entire organization.</p>
        </div>
        <div class="card">
          <h3>Executive Protection</h3>
          <p>Dedicated VIP medical teams for personal, travel, and event coverage.</p>
        </div>
      </div>
    </section>

    <section class="doctors js-scroll">
      <h2>Meet Our Elite Responders</h2>
      <div class="doctor-list">
        <div class="doctor-card" data-doctor="Dr. R. Sharma">
          <div class="doctor-image-container">
            <img src="doctor1.jpg" alt="Dr. Sharma" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë®‚Äç‚öïÔ∏è</div>';">
          </div>
          <h4>Dr. R. Sharma</h4>
          <p>Chief Medical Officer</p>
        </div>
        <div class="doctor-card" data-doctor="Dr. M. Gupta">
          <div class="doctor-image-container">
            <img src="doctor2.png" alt="Dr. Gupta" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë©‚Äç‚öïÔ∏è</div>';">
          </div>
          <h4>Dr. M. Gupta</h4>
          <p>Orthopedic & Plastic Surgeon</p>
        </div>
        <div class="doctor-card" data-doctor="Dr. Jyoti">
          <div class="doctor-image-container">
            <img src="doctor3.png" alt="Dr. Jyoti" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë®‚Äç‚öïÔ∏è</div>';">
          </div>
          <h4>Dr. Jyoti</h4>
          <p>Trauma & Surgical Lead</p>
        </div>
      </div>
    </section>
<!-- PART 2: booking form, invoice, email modal, chat, footer (paste second) -->
    <section id="book" class="container cta js-scroll">
      <h2>Schedule Consultation</h2>
      <p>Your connection to our elite medical team is one click away.</p>

      <button id="showFormBtn" class="btn" type="button">Book Now</button>

      <form class="booking-form" id="bookingForm" style="display: none; margin-top: 20px;">
        <div class="form-group">
          <label for="patientName">Full Name:</label>
          <input type="text" id="patientName" name="patientName" required maxlength="200">
          <span class="error-message" id="nameError"></span>
        </div>

        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required maxlength="255">
          <span class="error-message" id="emailError"></span>
        </div>

        <div class="form-group">
          <label for="doctor">Select Specialist:</label>
          <select id="doctor" name="doctor" required>
            <option value="">-- Choose a Specialist --</option>
            <option value="Dr. R. Sharma">Dr. R. Sharma - Chief Medical Officer</option>
            <option value="Dr. M. Gupta">Dr. M. Gupta - Orthopedic & Plastic Surgeon</option>
            <option value="Dr. Jyoti">Dr. Jyoti - Trauma & Surgical Lead</option>
          </select>
          <span class="error-message" id="doctorError"></span>
        </div>

        <div class="form-group">
          <label for="appointmentDate">Consultation Date:</label>
          <input type="date" id="appointmentDate" name="appointmentDate" required>
          <span class="error-message" id="dateError"></span>
        </div>

        <div class="form-group">
          <label for="appointmentTime">Consultation Time:</label>
          <input type="time" id="appointmentTime" name="appointmentTime" required>
          <span class="error-message" id="timeError"></span>
        </div>

        <div class="form-group">
          <label for="message">Additional Notes:</label>
          <textarea id="message" name="message" rows="3" placeholder="Any specific concerns or requirements..." maxlength="1000"></textarea>
        </div>

        <button type="submit" class="btn" id="submitBooking">Confirm Consultation</button>

        <div id="formMessage" class="message" style="display: none;"></div>
      </form>
    </section>

    <!-- Appointment History Section -->
    <section id="appointments" class="container js-scroll" style="display: none;">
      <h2>Your Appointments</h2>
      <div id="appointmentsList" class="appointment-history">
        <!-- Appointments will be loaded here -->
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn btn-secondary" onclick="showBookingSection()">Book New Consultation</button>
      </div>
    </section>
  </main>

  <!-- Invoice Screen -->
  <section id="invoiceScreen">
    <div class="invoice-box">
      <div class="invoice-header">
        <h2>üéâ Consultation Received!</h2>
        <p>Your booking has been received by Trauma Team International</p>
      </div>

      <div class="invoice-details">
        <div class="invoice-section">
          <h3>Patient Information</h3>
          <p><strong>Name:</strong> <span id="invoicePatientName"></span></p>
          <p><strong>Email:</strong> <span id="invoicePatientEmail"></span></p>
        </div>

        <div class="invoice-section">
          <h3>Appointment Details</h3>
          <p><strong>Doctor:</strong> <span id="invoiceDoctor"></span></p>
          <p><strong>Date:</strong> <span id="invoiceDate"></span></p>
          <p><strong>Time:</strong> <span id="invoiceTime"></span></p>
        </div>

        <div class="invoice-section">
          <h3>Booking & Payment</h3>
          <p><strong>Invoice ID:</strong> <span id="invoiceId"></span></p>
          <p><strong>Payment Status:</strong> <span id="invoicePaymentStatus">Pending</span></p>
          <p><strong>Amount (Payable):</strong> <span id="invoiceAmount"></span></p>
        </div>

        <div class="invoice-section">
          <h3>Next Steps</h3>
          <p>‚Ä¢ You will receive a confirmation email with booking details.</p>
          <p>‚Ä¢ Our team will contact you 24 hours before your appointment.</p>
          <p>‚Ä¢ Emergency contact: +91 98765 43210</p>
        </div>
      </div>

      <div class="invoice-actions">
        <button type="button" class="btn btn-success" onclick="window.print()">
          üñ®Ô∏è Print Receipt
        </button>
        <button type="button" class="btn btn-secondary" onclick="closeInvoiceScreen()" id="doneButton">
          Done
        </button>
      </div>

      <div id="invoiceMessage" class="message" style="display: none; margin-top: 20px;"></div>
    </div>
  </section>

  <!-- Email Success Modal -->
  <div id="emailSuccessModal"
       style="
         position: fixed; top:0; left:0; width:100%; height:100%;
         background: rgba(0,0,0,0.85); display:none; z-index:3000;
         justify-content:center; align-items:center;
       ">
    <div style="
        background: var(--primary-dark);
        padding:40px; border-radius:12px;
        border:1px solid var(--accent-red);
        width:90%; max-width:400px; text-align:center;
        box-shadow:0 0 20px rgba(229,9,20,0.5);
        animation: fadeInScale .4s ease-out;
    ">
      <svg class="checkmark" xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 52 52" style="margin:auto;">
        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
        <path class="checkmark__check" fill="none"
              d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
      </svg>

      <h2 style="margin-top:20px; color:var(--accent-green);">Email Sent!</h2>
      <p id="emailSuccessText" style="color:var(--text-secondary); margin-top:10px;">
        Your booking invoice has been emailed to you.
      </p>

      <button class="btn" onclick="closeEmailSuccessModal()"
              style="margin-top:20px; width:100%;">Continue</button>
    </div>
  </div>

  <style>
  @keyframes fadeInScale {
    0% { opacity:0; transform:scale(0.8);}
    100% { opacity:1; transform:scale(1);}
  }
  </style>

  <div class="chat-widget">
    <button class="chat-button" id="chatToggle">üí¨</button>
    <div class="chat-container" id="chatContainer">
      <div class="chat-header">
        <span>üöë Emergency Dispatch</span>
        <button class="close-chat" id="closeChat">√ó</button>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="message bot-message">
        ‚ù§Ô∏è Welcome to Trauma Team Dispatch. Please select an option below to get immediate assistance.
        </div>
      </div>
      <div class="quick-options" id="quickOptions">
        <button class="quick-option" data-option="emergency">üö® Medical Emergency</button>
        <button class="quick-option" data-option="dispatch">üìç Request Dispatch</button>
        <button class="quick-option" data-option="symptoms">ü§í Describe Symptoms</button>
        <button class="quick-option" data-option="contact">üìû Call Back Request</button>
      </div>
      <div class="typing-indicator" id="typingIndicator">
        Dispatch is typing...
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <p>
        üìç Global Response HQ, 1 Trauma Plaza, Dehradun, Uttarakhand, India ‚Äì 248001
      </p>
      <p>üìû +91 98765 43210 | ‚úâÔ∏è dispatch@traumateam.com</p>
      <div class="social-icons">
        <a href="https://facebook.com" target="_blank" aria-label="Facebook"><img src="facebook.png" alt="Facebook" onerror="this.style.display='none'; this.parentNode.innerHTML='üìò';"></a>
        <a href="https://instagram.com" target="_blank" aria-label="Instagram"><img src="instagram.png" alt="Instagram" onerror="this.style.display='none'; this.parentNode.innerHTML='üì∑';"></a>
        <a href="https://twitter.com" target="_blank" aria-label="Twitter"><img src="twitter.png" alt="Twitter" onerror="this.style.display='none'; this.parentNode.innerHTML='üê¶';"></a>
      </div>
      <div class="app-links">
        <a href="#"><img src="appstore.png" alt="Download on the App Store" onerror="this.style.display='none';"></a>
        <a href="#"><img src="playstore.png" alt="Get it on Google Play" onerror="this.style.display='none';"></a>
      </div>
      <div class="live-chat">
        <a href="#" class="chat-btn" id="footerChatBtn">üí¨ Emergency Dispatch Chat</a>
      </div>
      <p style="margin-top: 15px;">&copy; 2025 Trauma Team International. All rights reserved.</p>
    </div>
  </footer>
<!-- PART 3: JavaScript (paste last) -->
  <script>
    /******************************************************************
     * Frontend JS - Booking only (payment removed)
     * Works with backend at API_BASE_URL (render URL used)
     * Secure display (escapeHtml), CORS-ready fetch, and robust errors
     ******************************************************************/
    const API_BASE_URL = 'https://traumateam-backend-1.onrender.com';

    // Doctor pricing (used only for invoice display)
    const DOCTOR_PRICES = {
      "Dr. R. Sharma": 15000,
      "Dr. M. Gupta": 12000,
      "Dr. Jyoti": 18000
    };

    let currentBooking = null;

    // Minimal API client
    class TraumaTeamAPI {
      constructor(baseURL){
        this.baseURL = baseURL.replace(/\/+$/, '');
      }

      async request(path, opts = {}) {
        const url = this.baseURL + path;
        const defaultHeaders = { 'Content-Type': 'application/json' };
        const options = {
          mode: 'cors',
          ...opts,
          headers: { ...defaultHeaders, ...(opts.headers || {}) }
        };

        const res = await fetch(url, options);
        if (!res.ok) {
          const text = await res.text().catch(()=>'');
          let message = text || `Request failed: ${res.status} ${res.statusText}`;
          throw new Error(message);
        }
        // some endpoints return empty body ‚Äî handle gracefully
        const ct = res.headers.get('content-type') || '';
        if (ct.includes('application/json')) return res.json();
        return {};
      }

      createBooking(data){
        return this.request('/bookings/', { method: 'POST', body: JSON.stringify(data) });
      }

      getAppointments(){
        // requires auth on backend; we keep method for future when auth implemented
        return this.request('/api/appointments', { method: 'GET' });
      }
    }

    const api = new TraumaTeamAPI(API_BASE_URL);

    // XSS-safe text insertion
    function escapeHtml(unsafe){
      if (unsafe === null || unsafe === undefined) return '';
      return String(unsafe)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Show messages
    function showMessage(id, message, type='success'){
      const el = document.getElementById(id);
      if (!el) return;
      el.innerHTML = escapeHtml(message);
      el.className = `message ${type === 'error' ? 'error' : 'success'}`;
      el.style.display = 'block';
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function hideMessage(id){
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = 'none';
      el.innerHTML = '';
    }

    // Validation
    function validateForm(){
      let valid = true;
      const fields = ['patientName','email','doctor','appointmentDate','appointmentTime'];
      fields.forEach(f => {
        const err = document.getElementById(f+'Error');
        if (err) err.textContent = '';
      });

      const name = (document.getElementById('patientName') || {}).value?.trim();
      const email = (document.getElementById('email') || {}).value?.trim();
      const doctor = (document.getElementById('doctor') || {}).value;
      const dateVal = (document.getElementById('appointmentDate') || {}).value;
      const timeVal = (document.getElementById('appointmentTime') || {}).value;

      if (!name) { document.getElementById('nameError').textContent = 'This field is required'; valid = false; }
      if (!email) { document.getElementById('emailError').textContent = 'This field is required'; valid = false; }
      else {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!re.test(email)) { document.getElementById('emailError').textContent = 'Please enter a valid email'; valid = false; }
      }
      if (!doctor) { document.getElementById('doctorError').textContent = 'Please select a specialist'; valid = false; }
      if (!dateVal) { document.getElementById('dateError').textContent = 'Please choose a date'; valid = false; }
      else {
        const appt = new Date(dateVal);
        const today = new Date(); today.setHours(0,0,0,0);
        if (appt < today) { document.getElementById('dateError').textContent = 'Date cannot be in the past'; valid = false; }
      }
      if (!timeVal) { document.getElementById('timeError').textContent = 'Please choose a time'; valid = false; }

      return valid;
    }

    // Invoice population
    function populateInvoice(booking){
      document.getElementById('invoicePatientName').textContent = escapeHtml(booking.patient_name || booking.patientName || '');
      document.getElementById('invoicePatientEmail').textContent = escapeHtml(booking.email || '');
      document.getElementById('invoiceDoctor').textContent = escapeHtml(booking.doctor || '');
      document.getElementById('invoiceDate').textContent = escapeHtml(booking.appointment_date || '');
      document.getElementById('invoiceTime').textContent = escapeHtml(booking.appointment_time || '');
      document.getElementById('invoiceId').textContent = escapeHtml(booking.invoice_id || booking.id || '');
      const price = DOCTOR_PRICES[booking.doctor] || 0;
      document.getElementById('invoiceAmount').textContent = price ? `‚Çπ${price.toLocaleString()}` : '‚Çπ0';
      document.getElementById('invoicePaymentStatus').textContent = (booking.payment_status || 'pending').toUpperCase();
    }

    // Show invoice modal (no payment)
    function showInvoiceScreen(booking){
      currentBooking = booking;
      populateInvoice(booking);
      document.getElementById('invoiceScreen').style.display = 'flex';
      // hide main layout to prevent background interactions
      const main = document.querySelector('main'); if (main) main.style.display = 'none';
      const header = document.querySelector('header'); if (header) header.style.display = 'none';
      const footer = document.querySelector('footer'); if (footer) footer.style.display = 'none';
      window.scrollTo(0,0);
    }

    function closeInvoiceScreen(){
      document.getElementById('invoiceScreen').style.display = 'none';
      const main = document.querySelector('main'); if (main) main.style.display = 'block';
      const header = document.querySelector('header'); if (header) header.style.display = 'block';
      const footer = document.querySelector('footer'); if (footer) footer.style.display = 'block';
      // reset form
      const form = document.getElementById('bookingForm');
      if (form) {
        form.reset();
        form.style.display = 'none';
      }
      const showBtn = document.getElementById('showFormBtn'); if (showBtn) showBtn.style.display = 'inline-block';
      hideMessage('formMessage');
    }

    // Email success modal functions (clean and global)
    function showEmailSuccessModal(booking){
      currentBooking = booking;
      const fullName = escapeHtml(booking.patient_name || '');
      const email = escapeHtml(booking.email || '');

      const textEl = document.getElementById('emailSuccessText');
      if (textEl) {
        textEl.innerHTML = `Hello <strong>${fullName}</strong>,<br>Your consultation invoice has been emailed to <strong>${email}</strong>.`;
      }

      const modal = document.getElementById('emailSuccessModal');
      if (modal) modal.style.display = 'flex';

      // Auto-open invoice after delay (3s)
      setTimeout(() => {
        closeEmailSuccessModal();
        showInvoiceScreen(booking);
      }, 3000);
    }

    function closeEmailSuccessModal(){
      const modal = document.getElementById('emailSuccessModal');
      if (modal) modal.style.display = 'none';
    }

    // Appointment history: backend requires auth; we display friendly message
    async function showAppointmentHistory(){
      // hide sections
      document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
      const appointmentsSection = document.getElementById('appointments');
      appointmentsSection.style.display = 'block';

      const list = document.getElementById('appointmentsList');
      list.innerHTML = '<p style="text-align:center;color:var(--text-secondary)"><em>Appointment history is available for logged-in users only.</em></p>';
    }

    // Helper to show booking section
    function showBookingSection(){
      document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
      const bookSection = document.getElementById('book');
      if (bookSection) bookSection.style.display = 'block';
      const showFormBtn = document.getElementById('showFormBtn');
      const bookingForm = document.getElementById('bookingForm');
      if (showFormBtn) showFormBtn.style.display = 'inline-block';
      if (bookingForm) bookingForm.style.display = 'none';
    }

    // DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      // Loading screen hide
      window.addEventListener('load', () => {
        setTimeout(()=>{
          const ls = document.getElementById('loadingScreen');
          if (ls) { ls.style.opacity = '0'; setTimeout(()=>ls.style.display='none', 500); }
        }, 800);
      });

      // Show booking form
      const showFormBtn = document.getElementById('showFormBtn');
      const bookingForm = document.getElementById('bookingForm');
      if (showFormBtn) {
        showFormBtn.addEventListener('click', () => {
          bookingForm.style.display = 'block';
          showFormBtn.style.display = 'none';
          // scroll into view
          bookingForm.scrollIntoView({behavior:'smooth'});
        });
      }

      // appointment date min to today
      const today = new Date().toISOString().split('T')[0];
      const appointmentDateInput = document.getElementById('appointmentDate');
      if (appointmentDateInput) appointmentDateInput.min = today;

      // Doctor selection UI: clicking a doctor-card selects it and sets the select
      const doctorCards = document.querySelectorAll('.doctor-card');
      doctorCards.forEach(card => {
        card.addEventListener('click', () => {
          // remove selected class from others
          doctorCards.forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          const doc = card.getAttribute('data-doctor');
          const select = document.getElementById('doctor');
          if (select && doc) {
            select.value = doc;
            // remove any validation errors visually
            const de = document.getElementById('doctorError'); if (de) de.textContent = '';
          }
        });
      });

      // booking submission (fixed, no stray calls)
     if (bookingForm) {
  bookingForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    e.stopPropagation();
    hideMessage('formMessage');

    if (!validateForm()) return;

    const submitBtn = document.getElementById('submitBooking');
    const originalText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = 'Processing...';

    try {
      const payload = {
        patient_name: document.getElementById('patientName').value.trim(),
        email: document.getElementById('email').value.trim(),
        doctor: document.getElementById('doctor').value,
        appointment_date: document.getElementById('appointmentDate').value,
        appointment_time: document.getElementById('appointmentTime').value,
        message: document.getElementById('message').value.trim() || 'No additional notes'
      };

      if (!DOCTOR_PRICES[payload.doctor]) {
        throw new Error('Invalid doctor selection');
      }

      const result = await api.createBooking(payload);

      // FIRST show success animation
      showEmailSuccessModal(result);

    } catch (err) {
      console.error('Booking error', err);
      showMessage('formMessage', `Error: ${err.message || 'Booking failed'}`, 'error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  });
}

            // double-check doctor; server validates again
            if (!DOCTOR_PRICES[payload.doctor]) {
              throw new Error('Invalid doctor selection');
            }

            const result = await api.createBooking(payload);
            // server returns booking object with id & invoice_id
            currentBooking = result;

            // show animated email-sent modal then invoice (non-blocking)
            showEmailSuccessModal(result);

            showMessage('formMessage', 'Booking created successfully. Check your email for confirmation.', 'success');

          } catch (err) {
            console.error('Booking error', err);
            showMessage('formMessage', `Error: ${err.message || 'Booking failed'}`, 'error');
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });
      }

      // Scroll observer for animations
      const scrollElements = document.querySelectorAll('.js-scroll');
      const heroContent = document.querySelector('.hero-content');
      if (heroContent) heroContent.classList.add('visible');

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add('visible');
        });
      }, { threshold: 0.12 });

      scrollElements.forEach(el => { if (!el.classList.contains('hero-content')) observer.observe(el); });

      // Chat functionality
      const chatToggle = document.getElementById('chatToggle');
      const chatContainer = document.getElementById('chatContainer');
      const closeChat = document.getElementById('closeChat');
      const chatMessages = document.getElementById('chatMessages');
      const quickOptions = document.getElementById('quickOptions');
      const typingIndicator = document.getElementById('typingIndicator');
      const footerChatBtn = document.getElementById('footerChatBtn');

      const botResponses = {
        emergency: "üö® EMERGENCY PROTOCOL ACTIVATED! Trauma Team has been dispatched to your location. ETA: 5-7 minutes. Please ensure safe access. Medical team is en route with full emergency equipment.",
        dispatch: "üìç Dispatch team mobilized! Please confirm your exact location. Our rapid response unit is preparing for deployment. Standard response time: 8-12 minutes in urban areas.",
        symptoms: "ü§í Please describe symptoms in detail. Our medical AI is analyzing potential conditions. For critical symptoms (chest pain, difficulty breathing, severe bleeding) - dispatch has been pre-authorized.",
        contact: "üìû Call back requested! Our dispatch coordinator will contact you within 90 seconds. Please keep your line clear. Emergency priority: HIGH. Response ID: TT-" + Date.now()
      };

      function addMessage(text, isUser = false) {
        const d = document.createElement('div');
        d.className = 'message ' + (isUser ? 'user-message' : 'bot-message');
        d.textContent = text;
        chatMessages.appendChild(d);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function showTyping() {
        if (typingIndicator) typingIndicator.style.display = 'block';
        if (chatMessages) chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      function hideTyping() { if (typingIndicator) typingIndicator.style.display = 'none'; }

      function handleQuickOption(option) {
        const btn = quickOptions.querySelector(`[data-option="${option}"]`);
        const optionText = btn ? btn.textContent : option;
        addMessage(optionText, true);
        showTyping();
        setTimeout(()=>{ hideTyping(); addMessage(botResponses[option]||'Acknowledged'); }, 1000 + Math.random()*1000);
      }

      if (chatToggle) chatToggle.addEventListener('click', ()=> chatContainer.style.display = 'flex');
      if (closeChat) closeChat.addEventListener('click', ()=> chatContainer.style.display = 'none');
      if (footerChatBtn) footerChatBtn.addEventListener('click', (e)=>{ e.preventDefault(); chatContainer.style.display='flex'; });

      document.querySelectorAll('.quick-option').forEach(opt => {
        opt.addEventListener('click', ()=> handleQuickOption(opt.getAttribute('data-option')));
      });

      document.addEventListener('click', (e)=>{
        if (chatContainer && chatContainer.style.display === 'flex') {
          if (!chatContainer.contains(e.target) && chatToggle && !chatToggle.contains(e.target) && footerChatBtn && !footerChatBtn.contains(e.target)) {
            chatContainer.style.display = 'none';
          }
        }
      });

      // Invoice Done button
      const doneBtn = document.getElementById('doneButton');
      if (doneBtn) doneBtn.addEventListener('click', ()=> closeInvoiceScreen());
    });
  </script>
</body>
</html>
