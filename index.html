<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" /> 
    <title>Trauma Team International - Your Elite Medical Response</title> 
    <style> 
        /* --- Loading Screen Styles --- */ 
        #loadingScreen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: var(--bg-color); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 9999; 
            transition: opacity 0.5s ease-out; 
        } 
        .loading-logo { 
            height: 80px; 
            margin-bottom: 30px; 
            mix-blend-mode: screen; 
            filter: drop-shadow(0 0 10px var(--accent-red)); 
        } 
        .spinner { 
            width: 50px; 
            height: 50px; 
            border: 4px solid var(--secondary-dark); 
            border-top: 4px solid var(--accent-red); 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            margin-bottom: 20px; 
        } 
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        } 
        .loading-text { 
            color: var(--text-primary); 
            font-size: 1.2rem; 
            text-align: center; 
        } 
        /* --- CSS Variables --- */ 
        :root { 
            --bg-color: #000000; 
            --primary-dark: #1a1a1a; 
            --secondary-dark: #2a2a2a; 
            --text-primary: #f5f5f5; 
            --text-secondary: #a0a0a0; 
            --accent-red: #e50914; 
            --accent-red-hover: #f40612; 
            --accent-blue: #007bff; 
            --accent-blue-hover: #0056b3; 
            --accent-green: #28a745; 
        } 
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        } 
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-image: url('main-bg.webp'); 
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed; 
            background-color: var(--bg-color); 
            color: var(--text-primary); 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            line-height: 1.6; 
            position: relative; 
        } 
        body::before { 
            content: ''; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.85); 
            z-index: -1; 
        } 
        .navbar { 
            background-color: rgba(0, 0, 0, 0.8); 
            backdrop-filter: blur(10px); 
            padding: 10px 20px; 
            border-bottom: 1px solid var(--secondary-dark); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            display: flex; 
            justify-content: center; 
        } 
        .navbar-brand { 
            color: white; 
            text-decoration: none; 
            font-size: 1.5rem; 
            display: flex; 
            align-items: center; 
            font-weight: bold; 
        } 
        .navbar-brand img { 
            height: 40px; 
            margin-right: 15px; 
            mix-blend-mode: screen; 
        } 
        .hero { 
            background: transparent; 
            text-align: center; 
            padding: 200px 20px 150px 20px; 
            position: relative; 
            flex-shrink: 0; 
        } 
        .hero-content { 
            position: relative; 
            z-index: 2; 
            max-width: 800px; 
            margin: 0 auto; 
            background: transparent; 
            padding: 20px; 
            border-radius: 10px; 
        } 
        .hero h1 { 
            font-size: 3.5rem; 
            font-weight: 900; 
            margin-bottom: 15px; 
            color: var(--text-primary); 
            text-shadow: 0 2px 8px rgba(0,0,0,0.7); 
        } 
        .hero h1 span { 
            color: var(--accent-red); 
        } 
        .hero p { 
            font-size: 1.3rem; 
            color: var(--text-secondary); 
            text-shadow: 0 1px 4px rgba(0,0,0,0.7); 
            margin-bottom: 30px; 
        } 
        .btn { 
            background-color: var(--accent-red); 
            color: var(--text-primary); 
            padding: 14px 28px; 
            border: none; 
            border-radius: 5px; 
            font-size: 18px; 
            font-weight: bold; 
            cursor: pointer; 
            text-decoration: none; 
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; 
            display: inline-block; 
            text-transform: uppercase; 
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.3); 
        } 
        .btn:hover { 
            background-color: var(--accent-red-hover); 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(229, 9, 20, 0.6); 
        } 
        .btn:disabled { 
            background-color: var(--secondary-dark); 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        } 
        .btn-secondary { 
            background-color: var(--secondary-dark); 
        } 
        .btn-secondary:hover { 
            background-color: #3a3a3a; 
        } 
        .btn-success { 
            background-color: var(--accent-green); 
        } 
        .btn-success:hover { 
            background-color: #218838; 
        } 
        .container { 
            background-color: var(--primary-dark); 
            padding: 40px; 
            border-radius: 10px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); 
            width: 100%; 
            max-width: 600px; 
            margin: 40px auto; 
            border: 1px solid var(--secondary-dark); 
        } 
        h2 { 
            text-align: center; 
            font-size: 2.5rem; 
            font-weight: 700; 
            color: var(--text-primary); 
            margin-bottom: 40px; 
        } 
        .features { 
            max-width: 1200px; 
            text-align: center; 
        } 
        .feature-cards { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            flex-wrap: wrap; 
        } 
        .card { 
            background: var(--primary-dark); 
            border: 1px solid var(--secondary-dark); 
            border-radius: 8px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
            padding: 30px; 
            margin: 10px; 
            width: 300px; 
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease; 
        } 
        .card:hover { 
            transform: scale(1.05); 
            border-color: var(--accent-red); 
            box-shadow: 0 8px 30px rgba(229, 9, 20, 0.4); 
        } 
        .card h3 { 
            color: var(--accent-red); 
            font-size: 1.5rem; 
            margin-top: 0; 
        } 
        .card p { 
            color: var(--text-secondary); 
            font-size: 1rem; 
        } 
        .doctors { 
            background-color: transparent; 
            padding: 60px 20px; 
            text-align: center; 
        } 
        .doctor-list { 
            display: flex; 
            justify-content: center; 
            flex-wrap: wrap; 
            gap: 30px; 
            max-width: 1200px; 
            margin: 0 auto; 
        } 
        .doctor-card { 
            background-color: var(--primary-dark); 
            color: var(--text-primary); 
            padding: 30px 20px; 
            border-radius: 10px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
            width: 280px; 
            border: 1px solid var(--secondary-dark); 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
        } 
        .doctor-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 25px rgba(229, 9, 20, 0.3); 
        } 
        .doctor-image-container { 
            width: 150px; 
            height: 150px; 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        } 
        .doctor-card img { 
            width: 100%; 
            height: 100%; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 4px solid var(--accent-red); 
        } 
        .doctor-img-fallback { 
            width: 150px; 
            height: 150px; 
            border-radius: 50%; 
            border: 4px solid var(--accent-red); 
            background: var(--secondary-dark); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 3.5rem; 
        } 
        .doctor-card h4 { 
            font-size: 1.4rem; 
            margin-bottom: 10px; 
            color: var(--text-primary); 
        } 
        .doctor-card p { 
            color: var(--text-secondary); 
            font-size: 1rem; 
            margin: 0; 
            line-height: 1.5; 
        } 
        .cta { 
            text-align: center; 
        } 
        .cta h2 { 
            color: var(--text-primary); 
        } 
        .cta p { 
            color: var(--text-secondary); 
            font-size: 1.1rem; 
        } 
        .form-group { 
            margin-bottom: 20px; 
            text-align: left; 
        } 
        label { 
            display: block; 
            margin-bottom: 8px; 
            color: var(--text-secondary); 
            font-weight: bold; 
        } 
        input[type="text"], input[type="email"], input[type="date"], input[type="time"], select, textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid var(--secondary-dark); 
            border-radius: 5px; 
            font-size: 16px; 
            box-sizing: border-box; 
            background-color: var(--secondary-dark); 
            color: var(--text-primary); 
            transition: border-color 0.3s, box-shadow 0.3s; 
        } 
        input[type="date"]::-webkit-calendar-picker-indicator, 
        input[type="time"]::-webkit-calendar-picker-indicator { 
            filter: invert(1); 
        } 
        input:focus, select:focus, textarea:focus { 
            border-color: var(--accent-red); 
            box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.25); 
            outline: none; 
        } 
        button[type="submit"] { 
            width: 100%; 
            margin-top: 10px; 
        } 
        .error-message { 
            color: #ff6b6b; 
            font-size: 14px; 
            margin-top: 5px; 
            display: block; 
            text-align: left; 
        } 
        .message { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 5px; 
            text-align: center; 
            font-weight: bold; 
        } 
        .message.success { 
            background-color: #198754; 
            color: #fff; 
        } 
        .message.error { 
            background-color: #dc3545; 
            color: #fff; 
        } 
        .footer { 
            background: var(--primary-dark); 
            color: var(--text-secondary); 
            padding: 40px 20px; 
            text-align: center; 
            margin-top: auto; 
            border-top: 1px solid var(--secondary-dark); 
        } 
        .footer-content { 
            position: relative; 
            z-index: 1; 
            max-width: 1000px; 
            margin: 0 auto; 
        } 
        .social-icons { 
            margin-top: 15px; 
        } 
        .social-icons a { 
            display: inline-block; 
            margin: 0 10px; 
        } 
        .social-icons img { 
            width: 28px; 
            transition: transform 0.2s ease, opacity 0.2s ease, filter 0.2s ease; 
            opacity: 0.7; 
            filter: grayscale(100%) invert(70%); 
        } 
        .social-icons img:hover { 
            transform: scale(1.2); 
            opacity: 1; 
            filter: grayscale(0) invert(0) drop-shadow(0 0 5px var(--accent-red)); 
        } 
        .app-links { 
            margin: 20px 0; 
        } 
        .app-links a img { 
            height: 40px; 
            margin: 0 10px; 
            opacity: 0.8; 
            transition: opacity 0.2s ease, filter 0.2s ease; 
        } 
        .app-links a img:hover { 
            opacity: 1; 
            filter: drop-shadow(0 0 5px var(--accent-red)); 
        } 
        .chat-btn { 
            display: inline-block; 
            background-color: var(--accent-blue); 
            color: white; 
            padding: 10px 20px; 
            font-size: 16px; 
            border-radius: 25px; 
            text-decoration: none; 
            transition: background-color 0.3s ease, box-shadow 0.3s ease; 
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); 
        } 
        .chat-btn:hover { 
            background-color: var(--accent-blue-hover); 
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5); 
        } 
        .js-scroll { 
            opacity: 0; 
            transform: translateY(50px); 
            transition: opacity 0.6s ease-out, transform 0.6s ease-out; 
        } 
        .js-scroll.visible { 
            opacity: 1; 
            transform: translateY(0); 
        } 
        /* --- Success Animation --- */ 
        .success-animation { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin: 20px 0; 
        } 
        .checkmark { 
            width: 80px; 
            height: 80px; 
            border-radius: 50%; 
            display: block; 
            stroke-width: 2; 
            stroke: #4bb71b; 
            stroke-miterlimit: 10; 
            box-shadow: inset 0px 0px 0px #4bb71b; 
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both; 
        } 
        .checkmark__circle { 
            stroke-dasharray: 166; 
            stroke-dashoffset: 166; 
            stroke-width: 2; 
            stroke-miterlimit: 10; 
            stroke: #4bb71b; 
            fill: none; 
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; 
        } 
        .checkmark__check { 
            transform-origin: 50% 50%; 
            stroke-dasharray: 48; 
            stroke-dashoffset: 48; 
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; 
        } 
        @keyframes stroke { 
            100% { stroke-dashoffset: 0; } 
        } 
        @keyframes scale { 
            0%, 100% { transform: none; } 
            50% { transform: scale3d(1.1, 1.1, 1); } 
        } 
        @keyframes fill { 
            100% { box-shadow: inset 0px 0px 0px 30px #4bb71b; } 
        } 
        /* --- Emergency Dispatch Chat Styles --- */ 
        .chat-widget { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            z-index: 1000; 
        } 
        .chat-button { 
            background-color: var(--accent-red); 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 60px; 
            height: 60px; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.4); 
            transition: all 0.3s ease; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        } 
        .chat-button:hover { 
            background-color: var(--accent-red-hover); 
            transform: scale(1.1); 
            box-shadow: 0 6px 20px rgba(229, 9, 20, 0.6); 
        } 
        .chat-container { 
            position: absolute; 
            bottom: 70px; 
            right: 0; 
            width: 350px; 
            height: 500px; 
            background: var(--primary-dark); 
            border: 1px solid var(--secondary-dark); 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); 
            display: none; 
            flex-direction: column; 
            overflow: hidden; 
        } 
        .chat-header { 
            background: var(--accent-red); 
            color: white; 
            padding: 15px; 
            text-align: center; 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        } 
        .close-chat { 
            background: none; 
            border: none; 
            color: white; 
            font-size: 20px; 
            cursor: pointer; 
        } 
        .chat-messages { 
            flex: 1; 
            padding: 15px; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        } 
        .message { 
            padding: 10px 15px; 
            border-radius: 18px; 
            max-width: 80%; 
            word-wrap: break-word; 
        } 
        .user-message { 
            background: var(--accent-blue); 
            color: white; 
            align-self: flex-end; 
            border-bottom-right-radius: 5px; 
        } 
        .bot-message { 
            background: var(--secondary-dark); 
            color: var(--text-primary); 
            align-self: flex-start; 
            border-bottom-left-radius: 5px; 
        } 
        .quick-options { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
            padding: 10px; 
            border-top: 1px solid var(--secondary-dark); 
        } 
        .quick-option { 
            background: var(--secondary-dark); 
            color: var(--text-primary); 
            border: 1px solid var(--accent-red); 
            border-radius: 20px; 
            padding: 8px 15px; 
            font-size: 12px; 
            cursor: pointer; 
            transition: all 0.2s ease; 
        } 
        .quick-option:hover { 
            background: var(--accent-red); 
            color: white; 
            box-shadow: 0 4px 10px rgba(229, 9, 20, 0.4); 
        } 
        .typing-indicator { 
            display: none; 
            align-self: flex-start; 
            background: var(--secondary-dark); 
            color: var(--text-secondary); 
            padding: 10px 15px; 
            border-radius: 18px; 
            font-style: italic; 
        } 
        /* Invoice Screen Styles */ 
        #invoiceScreen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.95); 
            z-index: 2000; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            padding: 20px; 
            box-sizing: border-box; 
            overflow-y: auto; 
        } 
        .invoice-box { 
            background-color: var(--primary-dark); 
            padding: 40px; 
            border-radius: 10px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); 
            width: 100%; 
            max-width: 700px; 
            border: 1px solid var(--secondary-dark); 
        } 
        .invoice-header { 
            text-align: center; 
            margin-bottom: 30px; 
            border-bottom: 2px solid var(--accent-red); 
            padding-bottom: 20px; 
        } 
        .invoice-details { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 30px; 
        } 
        .invoice-section { 
            background: var(--secondary-dark); 
            padding: 15px; 
            border-radius: 8px; 
            border: 1px solid var(--text-secondary); 
        } 
        .invoice-section h3 { 
            color: var(--accent-red); 
            margin-top: 0; 
            border-bottom: 1px solid var(--accent-red); 
            padding-bottom: 10px; 
        } 
        .invoice-actions { 
            display: flex; 
            gap: 10px; 
            justify-content: center; 
            flex-wrap: wrap; 
            margin-top: 30px; 
        } 
        /* Appointment History */ 
        .appointment-history { 
            margin-top: 40px; 
        } 
        .appointment-card { 
            background: var(--secondary-dark); 
            border: 1px solid var(--accent-red); 
            border-radius: 8px; 
            padding: 20px; 
            margin: 15px 0; 
            transition: all 0.3s ease; 
        } 
        .appointment-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3); 
        } 
        .appointment-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        } 
        .appointment-status { 
            padding: 5px 10px; 
            border-radius: 15px; 
            font-size: 12px; 
            font-weight: bold; 
        } 
        .status-confirmed { 
            background: #28a745; 
            color: white; 
        } 
        .status-pending { 
            background: #ffc107; 
            color: black; 
        } 
        .status-completed { 
            background: #17a2b8; 
            color: white; 
        } 
        /* =================== PART 1: ADMIN CSS =================== */ 
        #traumaAdminMessage { 
            margin-top: 8px; 
            display:block; 
        } 
        .status-badge { 
            padding:6px 10px;border-radius:12px;font-weight:700;font-size:12px;display:inline-block; 
        } 
        .status-pending { 
            background:#ffc107;color:#000; 
        } 
        .status-confirmed { 
            background:#28a745;color:#fff; 
        } 
        .status-cancelled { 
            background:#dc3545;color:#fff; 
        } 
        .admin-action-btn { 
            padding:6px 10px;border-radius:6px;border:none;cursor:pointer;margin:2px;font-size:13px; 
        } 
        .view-btn { 
            background:var(--accent-blue);color:#fff; 
        } 
        .confirm-btn { 
            background:var(--accent-green);color:#fff; 
        } 
        .cancel-btn { 
            background:var(--accent-red);color:#fff; 
        } 
        .booking-modal { 
            position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.75);display:none;justify-content:center;align-items:center;z-index:3000; 
        } 
        .modal-content { 
            background:var(--primary-dark);padding:22px;border-radius:10px;max-width:720px;width:94%;border:1px solid var(--accent-red); 
        } 
        @keyframes spin { 
            0%{transform:rotate(0)}100%{transform:rotate(360deg)} 
        } 
        /* responsive tweaks */ 
        @media (max-width: 768px) { 
            .hero { 
                padding: 150px 20px 100px; 
            } 
            .hero h1 { 
                font-size: 2.5rem; 
            } 
            .container { 
                padding: 20px; 
                width: 95%; 
            } 
            .chat-container { 
                width: 300px; 
                height: 400px; 
            } 
            .doctor-list { 
                gap: 20px; 
            } 
            .doctor-card { 
                width: 100%; 
                max-width: 280px; 
            } 
            .appointment-header { 
                flex-direction: column; 
                align-items: flex-start; 
            } 
            .invoice-details { 
                grid-template-columns: 1fr; 
            } 
            .invoice-actions { 
                flex-direction: column; 
            } 
            #traumaBookingsTable th, #traumaBookingsTable td { 
                font-size:13px; 
                padding:8px; 
            } 
        } 
        @media (max-width: 480px) { 
            .chat-container { 
                width: 280px; 
                right: -20px; 
            } 
            .modal-content{padding:16px} 
        } 
    </style> 
</head> 
<body> 
    <!-- Loading Screen --> 
    <div id="loadingScreen"> 
        <img src="logo.webp" alt="Trauma Team Logo" class="loading-logo" onerror="this.style.display='none';"> 
        <div class="spinner"></div> 
        <div class="loading-text">.Initializing mini-project.</div> 
    </div> 
    <header> 
        <nav class="navbar"> 
            <a class="navbar-brand" href="#"> 
                <img src="logo.webp" alt="Trauma Team Logo" onerror="this.style.display='none'; this.nextSibling?.remove();"> 
                <span></span> 
            </a> 
        </nav> 
    </header> 
    <main> 
        <section class="hero"> 
            <div class="hero-content js-scroll"> 
                <h1>Welcome to <span>Trauma Team International</span></h1> 
                <p>Your Elite Medical Response. Anytime. Anywhere.</p> 
                <br> 
                <a href="#book" class="btn">Book a Consultation</a> 
            </div> 
        </section> 
        <section class="features container js-scroll"> 
            <h2>Response Packages</h2> 
            <div class="feature-cards"> 
                <div class="card"> 
                    <h3>Rapid Response</h3> 
                    <p>Immediate dispatch and consultation for critical and urgent health needs.</p> 
                </div> 
                <div class="card"> 
                    <h3>Corporate Coverage</h3> 
                    <p>Full-service medical plans and on-site care for your entire organization.</p> 
                </div> 
                <div class="card"> 
                    <h3>Executive Protection</h3> 
                    <p>Dedicated VIP medical teams for personal, travel, and event coverage.</p> 
                </div> 
            </div> 
        </section> 
        <section class="doctors js-scroll"> 
            <h2>Meet Our Elite Responders</h2> 
            <div class="doctor-list"> 
                <div class="doctor-card"> 
                    <div class="doctor-image-container"> 
                        <img src="doctor1.jpg" alt="Dr. Sharma" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë®‚Äç‚öïÔ∏è</div>';"> 
                    </div> 
                    <h4>Dr. R. Sharma</h4> 
                    <p>Chief Medical Officer</p> 
                </div> 
                <div class="doctor-card"> 
                    <div class="doctor-image-container"> 
                        <img src="doctor2.png" alt="Dr. Gupta" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë©‚Äç‚öïÔ∏è</div>';"> 
                    </div> 
                    <h4>Dr. M. Gupta</h4> 
                    <p>Orthopedic & Plastic Surgeon</p> 
                </div> 
                <div class="doctor-card"> 
                    <div class="doctor-image-container"> 
                        <img src="doctor3.png" alt="Dr. Jyoti" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'doctor-img-fallback\'>üë®‚Äç‚öïÔ∏è</div>';"> 
                    </div> 
                    <h4>Dr. Jyoti</h4> 
                    <p>Trauma & Surgical Lead</p> 
                </div> 
            </div> 
        </section> 
        <section id="book" class="container cta js-scroll"> 
            <h2>Schedule Consultation</h2> 
            <p>Your connection to our elite medical team is one click away.</p> 
            <button id="showFormBtn" class="btn" type="button">Book Now</button> 
            <form class="booking-form" id="bookingForm" style="display: none; margin-top: 20px;"> 
                <div class="form-group"> 
                    <label for="patientName">Full Name:</label> 
                    <input type="text" id="patientName" name="patientName" required maxlength="200"> 
                    <span class="error-message" id="nameError"></span> 
                </div> 
                <div class="form-group"> 
                    <label for="email">Email:</label> 
                    <input type="email" id="email" name="email" required maxlength="255"> 
                    <span class="error-message" id="emailError"></span> 
                </div> 
                <div class="form-group"> 
                    <label for="doctor">Select Specialist:</label> 
                    <select id="doctor" name="doctor" required> 
                        <option value="">-- Choose a Specialist --</option> 
                        <option value="Dr. R. Sharma">Dr. R. Sharma - Chief Medical Officer</option> 
                        <option value="Dr. M. Gupta">Dr. M. Gupta - Orthopedic & Plastic Surgeon</option> 
                        <option value="Dr. Jyoti">Dr. Jyoti - Trauma & Surgical Lead</option> 
                    </select> 
                    <span class="error-message" id="doctorError"></span> 
                </div> 
                <div class="form-group"> 
                    <label for="appointmentDate">Consultation Date:</label> 
                    <input type="date" id="appointmentDate" name="appointmentDate" required> 
                    <span class="error-message" id="dateError"></span> 
                </div> 
                <div class="form-group"> 
                    <label for="appointmentTime">Consultation Time:</label> 
                    <input type="time" id="appointmentTime" name="appointmentTime" required> 
                    <span class="error-message" id="timeError"></span> 
                </div> 
                <div class="form-group"> 
                    <label for="message">Additional Notes:</label> 
                    <textarea id="message" name="message" rows="3" placeholder="Any specific concerns or requirements..." maxlength="1000"></textarea> 
                </div> 
                <button type="submit" class="btn" id="submitBooking">Confirm Consultation</button> 
                <div id="formMessage" class="message" style="display: none;"></div> 
            </form> 
        </section> 
        
        <!-- =================== PART 1: ADMIN HTML + CSS =================== --> 
        <!-- Admin Login Section --> 
        <section id="adminSection" class="container" style="display:none;"> 
            <h2>üîê Admin Portal</h2> 
            <p style="color: var(--text-secondary); text-align: center; margin-bottom: 20px;"> 
                Trauma Team Admin Dashboard ‚Äî secure access only. 
            </p> 
            <form id="traumaAdminLoginForm" style="max-width:520px;margin:0 auto 30px;"> 
                <div class="form-group"> 
                    <label for="traumaAdminEmail">Admin Email</label> 
                    <input type="email" id="traumaAdminEmail" name="email" placeholder="admin" required> 
                </div> 
                <div class="form-group"> 
                    <label for="traumaAdminPassword">Admin Password</label> 
                    <input type="password" id="traumaAdminPassword" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required> 
                </div> 
                <div style="display:flex;gap:12px;align-items:center;"> 
                    <button type="submit" class="btn btn-success" style="flex:1;">üîë Login as Admin</button> 
                    <button type="button" class="btn btn-secondary" onclick="showBookingSection()">‚Üê Back</button> 
                </div> 
                <div id="traumaAdminMessage" class="message" style="display:none;margin-top:14px;"></div> 
            </form> 
        </section> 
        
        <!-- Admin Dashboard Section --> 
        <section id="adminDashboard" class="container" style="display:none;"> 
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;"> 
                <h2>üëë Admin Dashboard</h2> 
                <div> 
                    <button class="btn" id="traumaRefreshBtn" title="Refresh admin data">üîÑ Refresh</button> 
                    <button class="btn btn-secondary" id="traumaLogoutBtn" title="Logout admin">üö™ Logout</button> 
                </div> 
            </div> 
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;margin-bottom:24px;"> 
                <div class="card"> 
                    <h3 style="color: var(--accent-red);">üìä Stats</h3> 
                    <p>Total Bookings: <strong id="traumaStatsTotal">0</strong></p> 
                    <p>Pending: <strong id="traumaStatsPending">0</strong></p> 
                    <p>Confirmed: <strong id="traumaStatsConfirmed">0</strong></p> 
                    <p>Paid: <strong id="traumaStatsPaid">0</strong></p> 
                </div> 
                <div class="card"> 
                    <h3 style="color: var(--accent-red);">‚ö° Quick Actions</h3> 
                    <button class="btn" onclick="traumaExportCSV()" style="width:100%;margin:6px 0;">üì• Export CSV</button> 
                    <button class="btn btn-secondary" onclick="traumaSendTestNotification()" style="width:100%;margin:6px 0;">üì¢ Test Notification</button> 
                </div> 
            </div> 
            <h3 style="margin-bottom:12px;">üìã Bookings</h3> 
            <div style="overflow-x:auto;border:1px solid var(--secondary-dark);border-radius:8px;"> 
                <table id="traumaBookingsTable" style="width:100%;border-collapse:collapse;"> 
                    <thead> 
                        <tr style="background:var(--secondary-dark);"> 
                            <th style="padding:10px;text-align:left;">ID</th> 
                            <th style="padding:10px;text-align:left;">Patient</th> 
                            <th style="padding:10px;text-align:left;">Doctor</th> 
                            <th style="padding:10px;text-align:left;">Date / Time</th> 
                            <th style="padding:10px;text-align:left;">Status</th> 
                            <th style="padding:10px;text-align:left;">Payment</th> 
                            <th style="padding:10px;text-align:left;">Actions</th> 
                        </tr> 
                    </thead> 
                    <tbody id="traumaBookingsBody"> 
                        <tr><td colspan="7" style="text-align:center;padding:20px;color:var(--text-secondary);">No bookings loaded</td></tr> 
                    </tbody> 
                </table> 
            </div> 
            <div id="traumaAdminLoading" style="text-align:center;padding:20px;display:none;"> 
                <div class="spinner" style="width:36px;height:36px;border:4px solid var(--secondary-dark);border-top:4px solid var(--accent-red);border-radius:50%;animation:spin 1s linear infinite;margin:8px auto;"></div> 
                <p style="color:var(--text-secondary);">Loading admin data‚Ä¶</p> 
            </div> 
        </section> 
        <!-- =================== END PART 1 =================== --> 
        
        <!-- Appointment History Section --> 
        <section id="appointments" class="container js-scroll" style="display: none;"> 
            <h2>Your Appointments</h2> 
            <div id="appointmentsList" class="appointment-history"> 
                <!-- Appointments will be loaded here --> 
            </div> 
            <div style="text-align: center; margin-top: 20px;"> 
                <button class="btn btn-secondary" onclick="showBookingSection()">Book New Consultation</button> 
            </div> 
        </section> 
    </main> 
    <!-- Invoice Screen --> 
    <section id="invoiceScreen"> 
        <div class="invoice-box"> 
            <div class="invoice-header"> 
                <h2>üéâ Consultation Received!</h2> 
                <p>Your booking has been received by Trauma Team International</p> 
            </div> 
            <div class="invoice-details"> 
                <div class="invoice-section"> 
                    <h3>Patient Information</h3> 
                    <p><strong>Name:</strong> <span id="invoicePatientName"></span></p> 
                    <p><strong>Email:</strong> <span id="invoicePatientEmail"></span></p> 
                </div> 
                <div class="invoice-section"> 
                    <h3>Appointment Details</h3> 
                    <p><strong>Doctor:</strong> <span id="invoiceDoctor"></span></p> 
                    <p><strong>Date:</strong> <span id="invoiceDate"></span></p> 
                    <p><strong>Time:</strong> <span id="invoiceTime"></span></p> 
                </div> 
                <div class="invoice-section"> 
                    <h3>Booking & Payment</h3> 
                    <p><strong>Invoice ID:</strong> <span id="invoiceId"></span></p> 
                    <p><strong>Payment Status:</strong> <span id="invoicePaymentStatus">Pending</span></p> 
                    <p><strong>Amount (Payable):</strong> <span id="invoiceAmount"></span></p> 
                </div> 
                <div class="invoice-section"> 
                    <h3>Next Steps</h3> 
                    <p>‚Ä¢ You will receive a confirmation email with booking details.</p> 
                    <p>‚Ä¢ Our team will contact you 24 hours before your appointment.</p> 
                    <p>‚Ä¢ Emergency contact: +91 98765 43210</p> 
                </div> 
            </div> 
            <div class="invoice-actions"> 
                <button type="button" class="btn btn-success" onclick="window.print()"> üñ®Ô∏è Print Receipt </button> 
                <button type="button" class="btn btn-secondary" onclick="closeInvoiceScreen()" id="doneButton"> Done </button> 
            </div> 
            <div id="invoiceMessage" class="message" style="display: none; margin-top: 20px;"></div> 
        </div> 
    </section> 
    <div class="chat-widget"> 
        <button class="chat-button" id="chatToggle">üí¨</button> 
        <div class="chat-container" id="chatContainer"> 
            <div class="chat-header"> 
                <span>üöë Emergency Dispatch</span> 
                <button class="close-chat" id="closeChat">√ó</button> 
            </div> 
            <div class="chat-messages" id="chatMessages"> 
                <div class="message bot-message"> ‚ù§Ô∏è Welcome to Trauma Team Dispatch. Please select an option below to get immediate assistance. </div> 
            </div> 
            <div class="quick-options" id="quickOptions"> 
                <button class="quick-option" data-option="emergency">üö® Medical Emergency</button> 
                <button class="quick-option" data-option="dispatch">üìç Request Dispatch</button> 
                <button class="quick-option" data-option="symptoms">ü§í Describe Symptoms</button> 
                <button class="quick-option" data-option="contact">üìû Call Back Request</button> 
            </div> 
            <div class="typing-indicator" id="typingIndicator"> Dispatch is typing... </div> 
        </div> 
    </div> 
    <footer class="footer"> 
        <div class="footer-content"> 
            <p> üìç Global Response HQ, 1 Trauma Plaza, Dehradun, Uttarakhand, India ‚Äì 248001 </p> 
            <p>üìû +91 98765 43210 | ‚úâÔ∏è dispatch@traumateam.com</p> 
            <div class="social-icons"> 
                <a href="https://facebook.com" target="_blank" aria-label="Facebook"><img src="facebook.png" alt="Facebook" onerror="this.style.display='none'; this.parentNode.innerHTML='üìò';"></a> 
                <a href="https://instagram.com" target="_blank" aria-label="Instagram"><img src="instagram.png" alt="Instagram" onerror="this.style.display='none'; this.parentNode.innerHTML='üì∑';"></a> 
                <a href="https://twitter.com" target="_blank" aria-label="Twitter"><img src="twitter.png" alt="Twitter" onerror="this.style.display='none'; this.parentNode.innerHTML='üê¶';"></a> 
            </div> 
            <div class="app-links"> 
                <a href="#"><img src="appstore.png" alt="Download on the App Store" onerror="this.style.display='none';"></a> 
                <a href="#"><img src="playstore.png" alt="Get it on Google Play" onerror="this.style.display='none';"></a> 
            </div> 
            <div class="live-chat"> 
                <a href="#" class="chat-btn" id="footerChatBtn">üí¨ Emergency Dispatch Chat</a> 
            </div> 
            <p style="margin-top: 15px;">&copy; 2025 Trauma Team International. All rights reserved.</p> 
        </div> 
    </footer> 
    <script> 
        /****************************************************************** 
         * Frontend JS - Booking only (payment removed) 
         * Works with backend at API_BASE_URL (default: http://localhost:8000) 
         * Secure display (escapeHtml), CORS-ready fetch, and robust errors 
         ******************************************************************/ 
        const API_BASE_URL = 'https://traumateam-backend-1.onrender.com'; 
        
        // Doctor pricing (used only for invoice display) 
        const DOCTOR_PRICES = { 
            "Dr. R. Sharma": 15000, 
            "Dr. M. Gupta": 12000, 
            "Dr. Jyoti": 18000 
        }; 
        
        let currentBooking = null; 
        
        // Minimal API client 
        class TraumaTeamAPI { 
            constructor(baseURL){ 
                this.baseURL = baseURL.replace(/\/+$/, ''); 
            } 
            
            async request(path, opts = {}) { 
                const url = this.baseURL + path; 
                const defaultHeaders = { 
                    'Content-Type': 'application/json' 
                }; 
                const options = { 
                    mode: 'cors', 
                    ...opts, 
                    headers: { 
                        ...defaultHeaders, 
                        ...(opts.headers || {}) 
                    } 
                }; 
                const res = await fetch(url, options); 
                if (!res.ok) { 
                    const text = await res.text().catch(()=>''); 
                    let message = text || `Request failed: ${res.status} ${res.statusText}`; 
                    throw new Error(message); 
                } 
                // some endpoints return empty body ‚Äî handle gracefully 
                const ct = res.headers.get('content-type') || ''; 
                if (ct.includes('application/json')) return res.json(); 
                return {}; 
            } 
            
            createBooking(data){ 
                return this.request('/bookings/', { 
                    method: 'POST', 
                    body: JSON.stringify(data) 
                }); 
            } 
            
            getAppointments(){ 
                // requires auth on backend; we keep method for future when auth implemented 
                return this.request('/api/appointments', { 
                    method: 'GET' 
                }); 
            } 
        } 
        
        const api = new TraumaTeamAPI(API_BASE_URL); 
        
        // XSS-safe text insertion 
        function escapeHtml(unsafe){ 
            if (unsafe === null || unsafe === undefined) return ''; 
            return String(unsafe) 
                .replace(/&/g, "&amp;") 
                .replace(/</g, "&lt;") 
                .replace(/>/g, "&gt;") 
                .replace(/"/g, "&quot;") 
                .replace(/'/g, "&#039;"); 
        } 
        
        // Show messages 
        function showMessage(id, message, type='success'){ 
            const el = document.getElementById(id); 
            if (!el) return; 
            el.innerHTML = escapeHtml(message); 
            el.className = `message ${type === 'error' ? 'error' : 'success'}`; 
            el.style.display = 'block'; 
            el.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
        } 
        
        function hideMessage(id){ 
            const el = document.getElementById(id); 
            if (!el) return; 
            el.style.display = 'none'; 
            el.innerHTML = ''; 
        } 
        
        // Validation 
        function validateForm(){ 
            let valid = true; 
            const fields = ['patientName','email','doctor','appointmentDate','appointmentTime']; 
            fields.forEach(f => { 
                const err = document.getElementById(f+'Error'); 
                if (err) err.textContent = ''; 
            }); 
            
            const name = document.getElementById('patientName').value.trim(); 
            const email = document.getElementById('email').value.trim(); 
            const doctor = document.getElementById('doctor').value; 
            const dateVal = document.getElementById('appointmentDate').value; 
            const timeVal = document.getElementById('appointmentTime').value; 
            
            if (!name) { 
                document.getElementById('nameError').textContent = 'This field is required'; 
                valid = false; 
            } 
            if (!email) { 
                document.getElementById('emailError').textContent = 'This field is required'; 
                valid = false; 
            } else { 
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; 
                if (!re.test(email)) { 
                    document.getElementById('emailError').textContent = 'Please enter a valid email'; 
                    valid = false; 
                } 
            } 
            if (!doctor) { 
                document.getElementById('doctorError').textContent = 'Please select a specialist'; 
                valid = false; 
            } 
            if (!dateVal) { 
                document.getElementById('dateError').textContent = 'Please choose a date'; 
                valid = false; 
            } else { 
                const appt = new Date(dateVal); 
                const today = new Date(); 
                today.setHours(0,0,0,0); 
                if (appt < today) { 
                    document.getElementById('dateError').textContent = 'Date cannot be in the past'; 
                    valid = false; 
                } 
            } 
            if (!timeVal) { 
                document.getElementById('timeError').textContent = 'Please choose a time'; 
                valid = false; 
            } 
            return valid; 
        } 
        
        // Invoice population 
        function populateInvoice(booking){ 
            document.getElementById('invoicePatientName').textContent = escapeHtml(booking.patient_name || booking.patientName || ''); 
            document.getElementById('invoicePatientEmail').textContent = escapeHtml(booking.email || ''); 
            document.getElementById('invoiceDoctor').textContent = escapeHtml(booking.doctor || ''); 
            document.getElementById('invoiceDate').textContent = escapeHtml(booking.appointment_date || ''); 
            document.getElementById('invoiceTime').textContent = escapeHtml(booking.appointment_time || ''); 
            document.getElementById('invoiceId').textContent = escapeHtml(booking.invoice_id || booking.id || ''); 
            const price = DOCTOR_PRICES[booking.doctor] || 0; 
            document.getElementById('invoiceAmount').textContent = price ? `‚Çπ${price.toLocaleString()}` : '‚Çπ0'; 
            document.getElementById('invoicePaymentStatus').textContent = (booking.payment_status || 'pending').toUpperCase(); 
        } 
        
        // Show invoice modal (no payment) 
        function showInvoiceScreen(booking){ 
            currentBooking = booking; 
            populateInvoice(booking); 
            document.getElementById('invoiceScreen').style.display = 'flex'; 
            // hide main layout to prevent background interactions 
            document.querySelector('main').style.display = 'none'; 
            document.querySelector('header').style.display = 'none'; 
            document.querySelector('footer').style.display = 'none'; 
            window.scrollTo(0,0); 
        } 
        
        function closeInvoiceScreen(){ 
            document.getElementById('invoiceScreen').style.display = 'none'; 
            const main = document.querySelector('main'); 
            if (main) main.style.display = 'block'; 
            const header = document.querySelector('header'); 
            if (header) header.style.display = 'block'; 
            const footer = document.querySelector('footer'); 
            if (footer) footer.style.display = 'block'; 
            // reset form 
            const form = document.getElementById('bookingForm'); 
            if (form) { 
                form.reset(); 
                form.style.display = 'none'; 
            } 
            const showBtn = document.getElementById('showFormBtn'); 
            if (showBtn) showBtn.style.display = 'inline-block'; 
            hideMessage('formMessage'); 
        } 
        
        // Appointment history: backend requires auth; we display friendly message 
        async function showAppointmentHistory(){ 
            // hide sections 
            document.querySelectorAll('main > section').forEach(s => s.style.display = 'none'); 
            const appointmentsSection = document.getElementById('appointments'); 
            appointmentsSection.style.display = 'block'; 
            const list = document.getElementById('appointmentsList'); 
            list.innerHTML = '<p style="text-align:center;color:var(--text-secondary)"><em>Appointment history is available for logged-in users only.</em></p>'; 
        } 
        
        // On DOM ready 
        document.addEventListener('DOMContentLoaded', () => { 
            // Loading screen hide 
            window.addEventListener('load', () => { 
                setTimeout(()=>{ 
                    const ls = document.getElementById('loadingScreen'); 
                    if (ls) { 
                        ls.style.opacity = '0'; 
                        setTimeout(()=>ls.style.display='none', 500); 
                    } 
                }, 800); 
            }); 
            
            // Show booking form 
            const showFormBtn = document.getElementById('showFormBtn'); 
            const bookingForm = document.getElementById('bookingForm'); 
            if (showFormBtn) { 
                showFormBtn.addEventListener('click', () => { 
                    bookingForm.style.display = 'block'; 
                    showFormBtn.style.display = 'none'; 
                    // scroll into view 
                    bookingForm.scrollIntoView({behavior:'smooth'}); 
                }); 
            } 
            
            // appointment date min to today 
            const today = new Date().toISOString().split('T')[0]; 
            const appointmentDateInput = document.getElementById('appointmentDate'); 
            if (appointmentDateInput) appointmentDateInput.min = today; 
            
            // booking submission 
            if (bookingForm) { 
                bookingForm.addEventListener('submit', async (e) => { 
                    e.preventDefault(); 
                    e.stopPropagation(); 
                    hideMessage('formMessage'); 
                    if (!validateForm()) return; 
                    
                    const submitBtn = document.getElementById('submitBooking'); 
                    const originalText = submitBtn.textContent; 
                    submitBtn.disabled = true; 
                    submitBtn.textContent = 'Processing...'; 
                    
                    try { 
                        const payload = { 
                            patient_name: document.getElementById('patientName').value.trim(), 
                            email: document.getElementById('email').value.trim(), 
                            doctor: document.getElementById('doctor').value, 
                            appointment_date: document.getElementById('appointmentDate').value, 
                            appointment_time: document.getElementById('appointmentTime').value, 
                            message: document.getElementById('message').value.trim() || 'No additional notes' 
                        }; 
                        
                        // double-check doctor server-side will also validate 
                        if (!DOCTOR_PRICES[payload.doctor]) { 
                            throw new Error('Invalid doctor selection'); 
                        } 
                        
                        const result = await api.createBooking(payload); 
                        // result should include id and invoice_id 
                        showInvoiceScreen(result); 
                        showMessage('formMessage', 'Booking created successfully. Check your email for confirmation.', 'success'); 
                    } catch (err) { 
                        console.error('Booking error', err); 
                        showMessage('formMessage', `Error: ${err.message || 'Booking failed'}`, 'error'); 
                    } finally { 
                        submitBtn.disabled = false; 
                        submitBtn.textContent = originalText; 
                    } 
                }); 
            } 
            
            // Scroll observer for animations 
            const scrollElements = document.querySelectorAll('.js-scroll'); 
            const heroContent = document.querySelector('.hero-content'); 
            if (heroContent) heroContent.classList.add('visible'); 
            
            const observer = new IntersectionObserver((entries) => { 
                entries.forEach(entry => { 
                    if (entry.isIntersecting) entry.target.classList.add('visible'); 
                }); 
            }, { threshold: 0.12 }); 
            
            scrollElements.forEach(el => { 
                if (!el.classList.contains('hero-content')) observer.observe(el); 
            }); 
            
            // Chat functionality (unchanged) 
            const chatToggle = document.getElementById('chatToggle'); 
            const chatContainer = document.getElementById('chatContainer'); 
            const closeChat = document.getElementById('closeChat'); 
            const chatMessages = document.getElementById('chatMessages'); 
            const quickOptions = document.getElementById('quickOptions'); 
            const typingIndicator = document.getElementById('typingIndicator'); 
            const footerChatBtn = document.getElementById('footerChatBtn'); 
            
            const botResponses = { 
                emergency: "üö® EMERGENCY PROTOCOL ACTIVATED! Trauma Team has been dispatched to your location. ETA: 5-7 minutes. Please ensure safe access. Medical team is en route with full emergency equipment.", 
                dispatch: "üìç Dispatch team mobilized! Please confirm your exact location. Our rapid response unit is preparing for deployment. Standard response time: 8-12 minutes in urban areas.", 
                symptoms: "ü§í Please describe symptoms in detail. Our medical AI is analyzing potential conditions. For critical symptoms (chest pain, difficulty breathing, severe bleeding) - dispatch has been pre-authorized.", 
                contact: "üìû Call back requested! Our dispatch coordinator will contact you within 90 seconds. Please keep your line clear. Emergency priority: HIGH. Response ID: TT-" + Date.now() 
            }; 
            
            function addMessage(text, isUser = false) { 
                const d = document.createElement('div'); 
                d.className = 'message ' + (isUser ? 'user-message' : 'bot-message'); 
                d.textContent = text; 
                chatMessages.appendChild(d); 
                chatMessages.scrollTop = chatMessages.scrollHeight; 
            } 
            
            function showTyping() { 
                typingIndicator.style.display = 'block'; 
                chatMessages.scrollTop = chatMessages.scrollHeight; 
            } 
            
            function hideTyping() { 
                typingIndicator.style.display = 'none'; 
            } 
            
            function handleQuickOption(option) { 
                const btn = quickOptions.querySelector(`[data-option="${option}"]`); 
                const optionText = btn ? btn.textContent : option; 
                addMessage(optionText, true); 
                showTyping(); 
                setTimeout(()=>{ 
                    hideTyping(); 
                    addMessage(botResponses[option]||'Acknowledged'); 
                }, 1000 + Math.random()*1000); 
            } 
            
            if (chatToggle) chatToggle.addEventListener('click', ()=> chatContainer.style.display = 'flex'); 
            if (closeChat) closeChat.addEventListener('click', ()=> chatContainer.style.display = 'none'); 
            if (footerChatBtn) footerChatBtn.addEventListener('click', (e)=>{ 
                e.preventDefault(); 
                chatContainer.style.display='flex'; 
            }); 
            
            document.querySelectorAll('.quick-option').forEach(opt => { 
                opt.addEventListener('click', ()=> handleQuickOption(opt.getAttribute('data-option'))); 
            }); 
            
            document.addEventListener('click', (e)=>{ 
                if (chatContainer && chatContainer.style.display === 'flex') { 
                    if (!chatContainer.contains(e.target) && !chatToggle.contains(e.target) && !footerChatBtn.contains(e.target)) { 
                        chatContainer.style.display = 'none'; 
                    } 
                } 
            }); 
            
            // Invoice Done button 
            document.getElementById('doneButton').addEventListener('click', ()=> closeInvoiceScreen()); 
        }); 
        
        // Helper to show booking section 
        function showBookingSection(){ 
            document.querySelectorAll('main > section').forEach(s => s.style.display = 'none'); 
            const bookSection = document.getElementById('book'); 
            if (bookSection) bookSection.style.display = 'block'; 
            const showFormBtn = document.getElementById('showFormBtn'); 
            const bookingForm = document.getElementById('bookingForm'); 
            if (showFormBtn) showFormBtn.style.display = 'inline-block'; 
            if (bookingForm) bookingForm.style.display = 'none'; 
        } 
    </script> 
    
    <!-- =================== PART 2: ADMIN JS =================== --> 
    <script> 
        /* trauma.admin.js - Core Admin Functionality Add this AFTER your existing JavaScript */ 
        (function(){ 
            // Config - uses existing API_BASE_URL from your frontend 
            const API = (typeof API_BASE_URL !== 'undefined') ? API_BASE_URL.replace(/\/$/, '') : 'http://localhost:8000'; 
            const TOKEN_KEY = 'trauma_admin_token_v1'; 
            const LOGGED_KEY = 'trauma_admin_logged_in_v1'; 
            
            // Local state 
            let traumaToken = null; 
            let traumaBookings = []; 
            
            // Utilities 
            function traumaEscape(s){ 
                if(s===null || s===undefined) return ''; 
                return String(s) 
                    .replace(/&/g,'&amp;') 
                    .replace(/</g,'&lt;') 
                    .replace(/>/g,'&gt;') 
                    .replace(/"/g,'&quot;') 
                    .replace(/'/g,'&#039;'); 
            } 
            
            function traumaShowMsg(elId, text, type='error'){ 
                const el = document.getElementById(elId); 
                if(!el) return; 
                el.textContent = text; 
                el.className = 'message ' + (type==='error' ? 'error' : 'success'); 
                el.style.display = 'block'; 
            } 
            
            function traumaHideMsg(elId){ 
                const el = document.getElementById(elId); 
                if(!el) return; 
                el.style.display='none'; 
                el.textContent=''; 
            } 
            
            // Attach login handler 
            document.addEventListener('DOMContentLoaded', ()=> { 
                const loginForm = document.getElementById('traumaAdminLoginForm'); 
                if(loginForm) loginForm.addEventListener('submit', traumaHandleLogin); 
                
                const logoutBtn = document.getElementById('traumaLogoutBtn'); 
                if(logoutBtn) logoutBtn.addEventListener('click', traumaLogout); 
                
                const refreshBtn = document.getElementById('traumaRefreshBtn'); 
                if(refreshBtn) refreshBtn.addEventListener('click', traumaLoadData); 
                
                // If token in storage, try restore 
                const saved = localStorage.getItem(TOKEN_KEY); 
                const logged = localStorage.getItem(LOGGED_KEY); 
                if(saved && logged === 'true'){ 
                    traumaToken = saved; 
                    traumaShowDashboard(); 
                    traumaLoadData().catch(()=>{ 
                        traumaLogout(); 
                        showAdminLogin(); 
                    }); 
                } 
            }); 
            
            // Show admin login (hide other main sections) 
            window.showAdminLogin = function(){ 
                document.querySelectorAll('main > section').forEach(s => s.style.display = 'none'); 
                const as = document.getElementById('adminSection'); 
                if(as) as.style.display = 'block'; 
                const dash = document.getElementById('adminDashboard'); 
                if(dash) dash.style.display = 'none'; 
                traumaHideMsg('traumaAdminMessage'); 
                const f = document.getElementById('traumaAdminLoginForm'); 
                if(f) f.reset(); 
            }; 
            
            // Show admin dashboard (hide login) 
            function traumaShowDashboard(){ 
                document.querySelectorAll('main > section').forEach(s => s.style.display = 'none'); 
                const as = document.getElementById('adminSection'); 
                if(as) as.style.display = 'none'; 
                const dash = document.getElementById('adminDashboard'); 
                if(dash) dash.style.display = 'block'; 
            } 
            
            // Login flow 
            async function traumaHandleLogin(e){ 
                e.preventDefault(); 
                traumaHideMsg('traumaAdminMessage'); 
                const email = (document.getElementById('traumaAdminEmail')||{}).value; 
                const password = (document.getElementById('traumaAdminPassword')||{}).value; 
                if(!email || !password){ 
                    traumaShowMsg('traumaAdminMessage','Please enter admin credentials','error'); 
                    return; 
                } 
                try { 
                    const res = await fetch(`${API}/admin/login`, { 
                        method: 'POST', 
                        headers: {'Content-Type':'application/json'}, 
                        body: JSON.stringify({ email, password }), 
                        mode: 'cors' 
                    }); 
                    if(!res.ok) { 
                        const t = await res.text().catch(()=>null); 
                        throw new Error(t || `Login failed (${res.status})`); 
                    } 
                    const data = await res.json(); 
                    traumaToken = data.token; 
                    localStorage.setItem(TOKEN_KEY, traumaToken); 
                    localStorage.setItem(LOGGED_KEY, 'true'); 
                    traumaShowDashboard(); 
                    await traumaLoadData(); 
                    traumaShowMsg('traumaAdminMessage','Login successful','success'); 
                } catch(err){ 
                    console.error('Admin login error', err); 
                    traumaShowMsg('traumaAdminMessage','Login error: '+err.message,'error'); 
                } 
            } 
            
            // Logout 
            function traumaLogout(){ 
                traumaToken = null; 
                traumaBookings = []; 
                localStorage.removeItem(TOKEN_KEY); 
                localStorage.removeItem(LOGGED_KEY); 
                // Return to booking section 
                showBookingSection(); 
                document.getElementById('adminSection')?.style.display = 'none'; 
                document.getElementById('adminDashboard')?.style.display = 'none'; 
            } 
            
            // Load admin data (bookings) 
            async function traumaLoadData(){ 
                const loading = document.getElementById('traumaAdminLoading'); 
                if(loading) loading.style.display = 'block'; 
                const body = document.getElementById('traumaBookingsBody'); 
                if(body) body.innerHTML = ''; 
                try { 
                    const res = await fetch(`${API}/admin/bookings`, { 
                        method: 'GET', 
                        headers: { 'Authorization': 'Bearer ' + traumaToken }, 
                        mode: 'cors' 
                    }); 
                    if(res.status === 403){ 
                        throw new Error('Admin session invalid or expired'); 
                    } 
                    if(!res.ok){ 
                        const t = await res.text().catch(()=>null); 
                        throw new Error(t || 'Failed to fetch bookings'); 
                    } 
                    const data = await res.json(); 
                    traumaBookings = data.bookings || []; 
                    traumaRenderBookings(); 
                    traumaUpdateStats(); 
                } catch(err){ 
                    console.error('Load admin data error', err); 
                    const bodyEl = document.getElementById('traumaBookingsBody'); 
                    if(bodyEl) bodyEl.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:28px;color:var(--accent-red)">‚ùå ${traumaEscape(err.message)}</td></tr>`; 
                    throw err; 
                } finally { 
                    if(loading) loading.style.display = 'none'; 
                } 
            } 
            
            // Update stats 
            function traumaUpdateStats(){ 
                const total = traumaBookings.length; 
                const pending = traumaBookings.filter(b => b.status === 'PENDING').length; 
                const confirmed = traumaBookings.filter(b => b.status === 'CONFIRMED').length; 
                const paid = traumaBookings.filter(b => b.payment_status === 'paid').length; 
                document.getElementById('traumaStatsTotal').textContent = total; 
                document.getElementById('traumaStatsPending').textContent = pending; 
                document.getElementById('traumaStatsConfirmed').textContent = confirmed; 
                document.getElementById('traumaStatsPaid').textContent = paid; 
            } 
            
            // Render bookings table 
            function traumaRenderBookings(){ 
                const body = document.getElementById('traumaBookingsBody'); 
                if(!body) return; 
                if(traumaBookings.length === 0){ 
                    body.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:24px;color:var(--text-secondary)">No bookings</td></tr>`; 
                    return; 
                } 
                const rows = traumaBookings.map(b => { 
                    const statusClass = (b.status === 'PENDING') ? 'status-pending' : (b.status === 'CONFIRMED' ? 'status-confirmed' : 'status-cancelled'); 
                    const payClass = (b.payment_status === 'paid') ? 'status-confirmed' : 'status-pending'; 
                    return `<tr> 
                        <td style="padding:10px;vertical-align:top;">${traumaEscape(b.id)}</td> 
                        <td style="padding:10px;vertical-align:top;"> 
                            <div style="font-weight:700">${traumaEscape(b.patient_name)}</div> 
                            <small style="color:var(--text-secondary)">${traumaEscape(b.email)}</small> 
                        </td> 
                        <td style="padding:10px;vertical-align:top;">${traumaEscape(b.doctor)}</td> 
                        <td style="padding:10px;vertical-align:top;"> 
                            ${traumaEscape(b.appointment_date)}<br><small style="color:var(--text-secondary)">${traumaEscape(b.appointment_time)}</small> 
                        </td> 
                        <td style="padding:10px;vertical-align:top;"> 
                            <span class="status-badge ${statusClass}">${traumaEscape(b.status)}</span> 
                        </td> 
                        <td style="padding:10px;vertical-align:top;"> 
                            <span class="status-badge ${payClass}">${traumaEscape(b.payment_status)}</span> 
                        </td> 
                        <td style="padding:10px;vertical-align:top;"> 
                            <button class="admin-action-btn view-btn" onclick="traumaViewBooking(${b.id})">üëÅÔ∏è View</button> 
                            <button class="admin-action-btn confirm-btn" onclick="traumaConfirmBooking(${b.id})" ${b.status === 'CONFIRMED' ? 'disabled' : ''}>‚úì Confirm</button> 
                        </td> 
                    </tr>`; 
                }).join(''); 
                body.innerHTML = rows; 
            } 
            
            // View booking modal 
            window.traumaViewBooking = function(id){ 
                const b = traumaBookings.find(x => x.id === id); 
                if(!b) return alert('Booking not found'); 
                const modal = document.createElement('div'); 
                modal.className = 'booking-modal'; 
                modal.innerHTML = `<div class="modal-content"> 
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;"> 
                        <h3 style="color:var(--accent-red);margin:0">Booking #${traumaEscape(b.id)}</h3> 
                        <button style="background:none;border:none;color:var(--text-secondary);font-size:22px;cursor:pointer" onclick="this.closest('.booking-modal').remove()">√ó</button> 
                    </div> 
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"> 
                        <div> 
                            <p><strong>Patient</strong><br>${traumaEscape(b.patient_name)}<br><small style="color:var(--text-secondary)">${traumaEscape(b.email)}</small></p> 
                            <p><strong>Message</strong><br><div style="background:var(--secondary-dark);padding:8px;border-radius:6px">${traumaEscape(b.message || 'No notes')}</div></p> 
                        </div> 
                        <div> 
                            <p><strong>Doctor</strong><br>${traumaEscape(b.doctor)}</p> 
                            <p><strong>When</strong><br>${traumaEscape(b.appointment_date)} ${traumaEscape(b.appointment_time)}</p> 
                            <p><strong>Invoice</strong><br>${traumaEscape(b.invoice_id || b.id)}</p> 
                            <p><strong>Status</strong><br><span class="status-badge ${b.status==='CONFIRMED'?'status-confirmed':'status-pending'}">${traumaEscape(b.status)}</span></p> 
                        </div> 
                    </div> 
                    <div style="text-align:center;margin-top:16px;"> 
                        <button class="btn" onclick="traumaConfirmBooking(${b.id}); this.closest('.booking-modal').remove()">‚úÖ Confirm</button> 
                        <button class="btn btn-secondary" onclick="this.closest('.booking-modal').remove()" style="margin-left:8px">Close</button> 
                    </div> 
                </div>`; 
                document.body.appendChild(modal); 
                modal.style.display = 'flex'; 
            }; 
            
            // Confirm booking action (calls consultation/confirm) 
            window.traumaConfirmBooking = async function(id){ 
                if(!confirm('Confirm this booking?')) return; 
                try { 
                    const res = await fetch(`${API}/consultation/confirm`, { 
                        method: 'POST', 
                        headers: { 
                            'Authorization': 'Bearer ' + traumaToken, 
                            'Content-Type': 'application/json' 
                        }, 
                        body: JSON.stringify({ booking_id: id }), 
                        mode: 'cors' 
                    }); 
                    if(!res.ok){ 
                        const t = await res.text().catch(()=>null); 
                        throw new Error(t || 'Failed to confirm'); 
                    } 
                    // Update local data 
                    const b = traumaBookings.find(x => x.id === id); 
                    if(b){ 
                        b.status = 'CONFIRMED'; 
                        b.consultation_confirmed = true; 
                    } 
                    traumaUpdateStats(); 
                    traumaRenderBookings(); 
                    alert('‚úÖ Booking confirmed'); 
                } catch(err){ 
                    console.error('Confirm booking error', err); 
                    alert('Error confirming booking: ' + (err.message || 'unknown')); 
                } 
            }; 
            
            // Export CSV 
            window.traumaExportCSV = function(){ 
                if(!traumaBookings || traumaBookings.length === 0) return alert('No bookings to export'); 
                const headers = ['ID','Patient','Email','Doctor','Date','Time','Status','Payment','Invoice']; 
                const rows = traumaBookings.map(b => [ 
                    b.id, 
                    `"${(b.patient_name||'').replace(/"/g,'""')}"`, 
                    b.email, 
                    b.doctor, 
                    b.appointment_date, 
                    b.appointment_time, 
                    b.status, 
                    b.payment_status, 
                    b.invoice_id||'' 
                ]); 
                const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n'); 
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); 
                const url = URL.createObjectURL(blob); 
                const a = document.createElement('a'); 
                a.href = url; 
                a.download = `trauma_bookings_${new Date().toISOString().slice(0,10)}.csv`; 
                a.style.display='none'; 
                document.body.appendChild(a); 
                a.click(); 
                a.remove(); 
                URL.revokeObjectURL(url); 
            }; 
            
            // Test notification - placeholder 
            window.traumaSendTestNotification = function(){ 
                alert('üì¢ Test notification sent!'); 
            }; 
            
            // show booking section helper (returns to public UI) 
            window.showBookingSection = function(){ 
                document.querySelectorAll('main > section').forEach(s => s.style.display = 'none'); 
                const bookSection = document.getElementById('book'); 
                if (bookSection) bookSection.style.display = 'block'; 
                const adminSection = document.getElementById('adminSection'); 
                if (adminSection) adminSection.style.display = 'none'; 
                const dash = document.getElementById('adminDashboard'); 
                if (dash) dash.style.display = 'none'; 
            }; 
        })(); 
    </script> 
    
    <!-- =================== PART 3: ADMIN ENHANCEMENTS =================== --> 
    <script> 
        /* trauma.admin.enhance.js ‚Äî Enhanced Features Add this AFTER Part 2 for search, filters, pagination, audit log */ 
        (function(){ 
            // Config: uses API from Part 2 
            const API_BASE = (typeof API_BASE_URL !== 'undefined') ? API_BASE_URL.replace(/\/$/, '') : 'http://localhost:8000'; 
            const TOKEN_KEY = 'trauma_admin_token_v1'; 
            const AUDIT_KEY = 'trauma_admin_audit_v1'; 
            
            // UI injection helper 
            function traumaInjectControls() { 
                const dashboard = document.getElementById('adminDashboard'); 
                if (!dashboard) return; 
                if (document.getElementById('traumaAdminControls')) return; 
                
                const controls = document.createElement('div'); 
                controls.id = 'traumaAdminControls'; 
                controls.style.cssText = 'display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:16px;'; 
                controls.innerHTML = ` 
                    <div style="display:flex;gap:8px;align-items:center;"> 
                        <input id="traumaSearchInput" placeholder="Search patient, email, doctor..." style="padding:8px;border-radius:6px;border:1px solid var(--secondary-dark);background:var(--secondary-dark);color:var(--text-primary);min-width:240px;"> 
                        <select id="traumaFilterSelect" style="padding:8px;border-radius:6px;border:1px solid var(--secondary-dark);background:var(--primary-dark);color:var(--text-primary);"> 
                            <option value="">All statuses</option> 
                            <option value="PENDING">Pending</option> 
                            <option value="CONFIRMED">Confirmed</option> 
                        </select> 
                        <select id="traumaPaymentFilter" style="padding:8px;border-radius:6px;border:1px solid var(--secondary-dark);background:var(--primary-dark);color:var(--text-primary);"> 
                            <option value="">All payments</option> 
                            <option value="paid">Paid</option> 
                            <option value="pending">Pending</option> 
                        </select> 
                    </div> 
                    <div style="margin-left:auto;display:flex;gap:8px;align-items:center;"> 
                        <label style="font-size:13px;color:var(--text-secondary);">Per page</label> 
                        <select id="traumaPerPage" style="padding:6px;border-radius:6px;border:1px solid var(--secondary-dark);background:var(--primary-dark);color:var(--text-primary);"> 
                            <option value="5">5</option> 
                            <option value="10" selected>10</option> 
                            <option value="25">25</option> 
                            <option value="50">50</option> 
                        </select> 
                        <button id="traumaExportAuditBtn" class="btn btn-secondary" title="Export audit log">üìù Export Log</button> 
                    </div> 
                `; 
                const bookingsTable = document.getElementById('traumaBookingsTable'); 
                bookingsTable.parentElement.insertBefore(controls, bookingsTable); 
            } 
            
            // Audit log 
            function traumaAudit(action, details) { 
                try { 
                    const now = new Date().toISOString(); 
                    const entry = { ts: now, action, details }; 
                    const raw = localStorage.getItem(AUDIT_KEY); 
                    const arr = raw ? JSON.parse(raw) : []; 
                    arr.unshift(entry); 
                    localStorage.setItem(AUDIT_KEY, JSON.stringify(arr.slice(0, 500))); 
                } catch (e) { 
                    console.warn('audit fail', e); 
                } 
            } 
            
            // Export audit log as CSV 
            function traumaExportAuditCSV() { 
                const raw = localStorage.getItem(AUDIT_KEY); 
                const arr = raw ? JSON.parse(raw) : []; 
                if (!arr.length) return alert('No audit log recorded yet.'); 
                const headers = ['Timestamp','Action','Details']; 
                const rows = arr.map(r => [ 
                    r.ts, 
                    `"${(r.action||'').replace(/"/g,'""')}"`, 
                    `"${(JSON.stringify(r.details)||'').replace(/"/g,'""')}"` 
                ]); 
                const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n'); 
                const blob = new Blob([csv], { type: 'text/csv' }); 
                const url = URL.createObjectURL(blob); 
                const a = document.createElement('a'); 
                a.href = url; 
                a.download = `trauma_admin_audit_${new Date().toISOString().slice(0,10)}.csv`; 
                document.body.appendChild(a); 
                a.click(); 
                a.remove(); 
                URL.revokeObjectURL(url); 
            } 
            
            // Client-side state 
            let traumaAll = []; 
            let traumaFiltered = []; 
            let traumaPage = 1; 
            let traumaPerPage = 10; 
            
            // Sync with Part 2 data 
            function traumaSyncWithPart2() { 
                if (window.traumaBookings) { 
                    traumaAll = window.traumaBookings; 
                } 
            } 
            
            // Filter + search 
            function traumaApplyFilters() { 
                const search = (document.getElementById('traumaSearchInput')||{value:''}).value.trim().toLowerCase(); 
                const statusFilter = (document.getElementById('traumaFilterSelect')||{value:''}).value; 
                const paymentFilter = (document.getElementById('traumaPaymentFilter')||{value:''}).value; 
                
                traumaFiltered = traumaAll.filter(b => { 
                    if (statusFilter && b.status !== statusFilter) return false; 
                    if (paymentFilter && (String(b.payment_status) !== paymentFilter)) return false; 
                    if (!search) return true; 
                    return ( 
                        (String(b.patient_name||'').toLowerCase().includes(search)) || 
                        (String(b.email||'').toLowerCase().includes(search)) || 
                        (String(b.doctor||'').toLowerCase().includes(search)) || 
                        (String(b.invoice_id||'').toLowerCase().includes(search)) 
                    ); 
                }); 
                traumaPage = 1; 
                traumaRenderPage(); 
            } 
            
            // Render paginated page 
            function traumaRenderPage() { 
                const tbody = document.getElementById('traumaBookingsBody'); 
                if (!tbody) return; 
                
                traumaPerPage = parseInt((document.getElementById('traumaPerPage')||{value:10}).value||10, 10); 
                const total = traumaFiltered.length; 
                const pages = Math.max(1, Math.ceil(total / traumaPerPage)); 
                if (traumaPage > pages) traumaPage = pages; 
                
                const start = (traumaPage - 1) * traumaPerPage; 
                const pageItems = traumaFiltered.slice(start, start + traumaPerPage); 
                
                if (!pageItems.length) { 
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:20px;color:var(--text-secondary)">No bookings match filters</td></tr>`; 
                } else { 
                    const rows = pageItems.map(b => { 
                        const statusClass = (b.status === 'PENDING') ? 'status-pending' : (b.status === 'CONFIRMED' ? 'status-confirmed' : 'status-pending'); 
                        const payClass = (b.payment_status === 'paid') ? 'status-confirmed' : 'status-pending'; 
                        return `<tr> 
                            <td style="padding:10px;vertical-align:top;">${b.id}</td> 
                            <td style="padding:10px;vertical-align:top;"> 
                                <div style="font-weight:700">${b.patient_name}</div> 
                                <small style="color:var(--text-secondary)">${b.email}</small> 
                            </td> 
                            <td style="padding:10px;vertical-align:top;">${b.doctor}</td> 
                            <td style="padding:10px;vertical-align:top;"> 
                                ${b.appointment_date}<br><small style="color:var(--text-secondary)">${b.appointment_time}</small> 
                            </td> 
                            <td style="padding:10px;vertical-align:top;"> 
                                <span class="status-badge ${statusClass}">${b.status}</span> 
                            </td> 
                            <td style="padding:10px;vertical-align:top;"> 
                                <span class="status-badge ${payClass}">${b.payment_status}</span> 
                            </td> 
                            <td style="padding:10px;vertical-align:top;"> 
                                <button class="admin-action-btn view-btn" onclick="traumaViewBooking(${b.id})">üëÅÔ∏è View</button> 
                                <button class="admin-action-btn confirm-btn" onclick="traumaForceConfirm(${b.id})" ${b.status === 'CONFIRMED' ? 'disabled' : ''}>‚úì Force Confirm</button> 
                            </td> 
                        </tr>`; 
                    }).join(''); 
                    tbody.innerHTML = rows; 
                } 
                
                // Pager UI 
                let pager = document.getElementById('traumaPager'); 
                if (!pager) { 
                    pager = document.createElement('div'); 
                    pager.id = 'traumaPager'; 
                    pager.style.cssText = 'display:flex;gap:8px;align-items:center;justify-content:center;margin-top:12px;'; 
                    document.getElementById('traumaBookingsTable').parentElement.appendChild(pager); 
                } 
                
                let pagerHtml = `<div style="color:var(--text-secondary);margin-right:8px">Page ${traumaPage} / ${pages}</div>`; 
                pagerHtml += `<button class="btn btn-secondary" ${traumaPage === 1 ? 'disabled' : ''} onclick="traumaGotoPage(1)">¬´ First</button>`; 
                pagerHtml += `<button class="btn btn-secondary" ${traumaPage === 1 ? 'disabled' : ''} onclick="traumaGotoPage(${Math.max(1, traumaPage-1)})">‚Äπ Prev</button>`; 
                const startPage = Math.max(1, traumaPage - 3); 
                const endPage = Math.min(pages, startPage + 6); 
                for (let p = startPage; p <= endPage; p++) { 
                    pagerHtml += `<button class="btn" ${p === traumaPage ? 'disabled style="opacity:0.6"' : ''} onclick="traumaGotoPage(${p})">${p}</button>`; 
                } 
                pagerHtml += `<button class="btn btn-secondary" ${traumaPage === pages ? 'disabled' : ''} onclick="traumaGotoPage(${Math.min(pages, traumaPage+1)})">Next ‚Ä∫</button>`; 
                pagerHtml += `<button class="btn btn-secondary" ${traumaPage === pages ? 'disabled' : ''} onclick="traumaGotoPage(${pages})">Last ¬ª</button>`; 
                pager.innerHTML = pagerHtml; 
                
                // Summary 
                let summary = document.getElementById('traumaListSummary'); 
                if (!summary) { 
                    summary = document.createElement('div'); 
                    summary.id = 'traumaListSummary'; 
                    summary.style.cssText = 'text-align:center;color:var(--text-secondary);margin-top:6px;font-size:13px;'; 
                    document.getElementById('traumaBookingsTable').parentElement.appendChild(summary); 
                } 
                summary.textContent = `Showing ${Math.min(total, start + 1)} - ${Math.min(total, start + pageItems.length)} of ${total} bookings`; 
            } 
            
            // Goto page helper 
            window.traumaGotoPage = function(p) { 
                traumaPage = p; 
                traumaRenderPage(); 
            }; 
            
            // Force confirm 
            window.traumaForceConfirm = async function(id){ 
                const b = traumaAll.find(x => x.id === id); 
                if (!b) return alert('Booking not found'); 
                if (!confirm(`Force confirm booking #${id}?`)) return; 
                
                b.status = 'CONFIRMED'; 
                b.consultation_confirmed = true; 
                traumaAudit('force_confirm', { id, email: b.email }); 
                traumaApplyFilters(); 
                
                try { 
                    const token = localStorage.getItem('trauma_admin_token_v1'); 
                    const res = await fetch(`${API_BASE}/consultation/confirm`, { 
                        method: 'POST', 
                        headers: { 
                            'Content-Type': 'application/json', 
                            'Authorization': token ? 'Bearer ' + token : '' 
                        }, 
                        body: JSON.stringify({ booking_id: id }) 
                    }); 
                    if (res.ok) { 
                        traumaAudit('force_confirm_server_ok', { id }); 
                    } else { 
                        traumaAudit('force_confirm_server_failed', { id, status: res.status }); 
                    } 
                } catch (e) { 
                    traumaAudit('force_confirm_server_error', { id, error: String(e) }); 
                } 
                
                // Update Part 2 stats 
                if (window.traumaUpdateStats) window.traumaUpdateStats(); 
                traumaRenderPage(); 
            }; 
            
            // Wire input events 
            function traumaWireInputs() { 
                const search = document.getElementById('traumaSearchInput'); 
                const status = document.getElementById('traumaFilterSelect'); 
                const pay = document.getElementById('traumaPaymentFilter'); 
                const per = document.getElementById('traumaPerPage'); 
                const expBtn = document.getElementById('traumaExportAuditBtn'); 
                
                if (search) search.addEventListener('input', () => { traumaApplyFilters(); }); 
                if (status) status.addEventListener('change', () => { traumaApplyFilters(); }); 
                if (pay) pay.addEventListener('change', () => { traumaApplyFilters(); }); 
                if (per) per.addEventListener('change', () => { traumaApplyFilters(); }); 
                if (expBtn) expBtn.addEventListener('click', traumaExportAuditCSV); 
            } 
            
            // Refresh dataset 
            window.traumaAdminEnhanceRefresh = function(newData) { 
                traumaAll = newData || traumaAll; 
                traumaApplyFilters(); 
                traumaAudit('refresh_data', { count: traumaAll.length }); 
            }; 
            
            // Initialize 
            function init() { 
                traumaInjectControls(); 
                traumaSyncWithPart2(); 
                traumaApplyFilters(); 
                traumaWireInputs(); 
                traumaAudit('admin_enhance_init', { at: new Date().toISOString() }); 
            } 
            
            // Start after short delay 
            setTimeout(init, 500); 
        })(); 
    </script> 
    <!-- =================== END PART 3 =================== --> 
</body> 
</html>
